{% extends "base.html" %}
{% block body %}

<h1>
    Payload-based Management
</h1>
<div style="resize: vertical; overflow:scroll" class="panel panel-primary" id="payloads_table" >
    <div class="panel-heading">Operation {{links.current_operation}}'s Payload Information</div>
        <table class="table table-striped table-hover table-condensed well-sm" >
            <tr>
                <td><b>Delete</b></td>
                <td><b>UUID</b></td>
                <td><b>Tag</b></td>
                <td><b>Creator</b></td>
                <td><b>Creation Time</b></td>
                <td><b>Payload Type</b></td>
                <td><b>C2 Profile</b></td>
                <td><b>Location</b></td>
            </tr>
        <!-- Repeat this for each web service -->
            <tr v-for="p in payloads" :key="p.creation_time" v-show="show_autogenerated || !p.location.includes('/payloads/operations/')">
                <td>
                    <button type="button" class="btn btn-danger btn-sm" @click="delete_button(p)" >Delete</button>
                </td>
                <td>
			        <button type="button" class="btn btn-info btn-sm" @click="show_uuid_button(p)">UUID</button>
		        </td>
                <td>[[ p.tag ]]</td>
                <td>[[ p.operator ]]</td>
                <td>[[ p.creation_time ]]</td>
                <td>[[ p.payload_type ]]</td>
                <td>[[ p.c2_profile ]]</td>
                <td>
                    <div v-if="p.location.includes('/payloads/operations/')">
                        [[ p.location.substring(p.location.indexOf('operations')) ]]
                    </div>
                    <div v-else>
                        [[ p.location ]]
                    </div>
                </td>
            </tr>
        <!-- End of the repeating -->
        </table>
</div>

<!-- THIS IS OUR MODAL FOR DELETING PAYLOAD -->
<div class="modal fade bs-example-modal-sm" id="payloadDeleteModal" role="dialog">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3 id="modalLabel">Are you sure? This could have implications elsewhere.</h3>
                Remove the specified payload from the database (and optionally from disk).
            </div>
              <div class="modal-body" id="payloadDeleteBody">
                  <h4>Delete from disk:&nbsp;&nbsp;<input type="checkbox" id="payloadDeleteFile"></h4>
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn-primary" data-dismiss="modal" id="payloadDeleteSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR DELETING PAYLOAD -->

<button type="button" class="btn btn-info btn-md" onclick="toggle_all_button()">Toggle Autogenerated</button>
<br><br>


<!-- PAYLOAD TYPE AND COMMAND INFORMATION/MODIFICATION/CREATION HERE -->
<div style="resize: vertical; overflow:scroll" class="panel panel-primary" id="payloadtypes_table" >
    <div class="panel-heading">Global PayloadType and Command Information</div>
        <table class="table table-striped table-hover table-condensed well-sm" >
            <tr>
                <td><b>Action</b></td>
                <td><b>Name</b></td>
                <td><b>Creator</b></td>
                <td><b>Registered Commands</b></td>
                <td><b>Edit Commands</b></td>
                <td><b>Compile Command</b></td>
                <td><b>Wrapper Info</b></td>
            </tr>
        <!-- Repeat this for each web service -->
            <tr v-for="p in payloadtypes" :key="p.creation_time">
                <td>
                    <button type="button" class="btn btn-danger btn-sm" @click="delete_payloadtype_button(p)" >Delete</button><br>
                    <button type="button" class="btn btn-info btn-sm" @click="edit_payloadtype_button(p)">Edit</button>
                </td>
                <td> [[ p.ptype ]] </td>
                <td> [[ p.operator ]] </td>
                <td width="750">
                    <span v-for="c in p.commands">
                        [[c.cmd]]
                    </span>
                </td>
                <td>
                    <button v-if="!p.wrapper" type="button" class="btn btn-success btn-sm" @click="add_commands_button(p)" >Add</button>
                    <button v-if="!p.wrapper" type="button" class="btn btn-info btn-sm" @click="edit_commands_button(p)" >Edit</button><br>
                    <button v-if="!p.wrapper" type="button" class="btn btn-danger btn-sm" @click="remove_commands_button(p)" >Remove</button><br>
                    <button v-if="!p.wrapper" type="button" class="btn btn-dark btn-sm" @click="export_commands_button(p)" >Export</button>
                    <button v-if="!p.wrapper" type="button" class="btn btn-success btn-sm" @click="import_commands_button(p)" >Import</button>
                </td>
                <td>
                    [[ p.compile_command ]]
                </td>
                <td>
                    <div v-if="p.wrapper">
                        <!-- Provide wrapper payload type specific things here -->
                        [[p.wrapped_encoding_type]]&nbsp;encoded&nbsp;[[p.wrapped_payload_type]]
                    </div>
                    <div v-else>
                        <!-- Not a wrapper, so just display something generic -->
                        False
                    </div>
                </td>
            </tr>
        <!-- End of the repeating -->
        </table>
</div>

<!-- THIS IS OUR MODAL FOR CREATING PAYLOADTYPE -->
<div class="modal fade bs-example-modal-md" id="payloadtypeCreateModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3>Register a new PayloadType</h3>
            </div>
              <div class="modal-body" id="payloadtypeCreateBody">
                  <table cellpadding="10" style="width:100%">
                    <tr>
                        <td style="width:150px">Name</td>
                        <td><input type="text" id="payloadtypeCreatePtype" size="50"></td>
                    </tr>
                      <tr>
                          <td style="width:150px">Payload file extension</td>
                          <td><input type="text" id="payloadtypeCreateFileExtension" size="50"></td>
                      </tr>
                      <tr>
                          <td style="width:150px">Compile command</td>
                          <td><input type="text" id="payloadtypeCreateCompileCommand" size="50"></td>
                      </tr>
                      <tr>
                          <td style="width:150px">Is this payload a wrapper for another payload?</td>
                          <td><input type="checkbox" id="payloadtypeCreateWrapper"></td>
                      </tr>
                      <tr hidden id="payloadtypeCreateWrappedEncodingTypeRow">
                          <td style="width:150px">Wrapped Payload Encoding Type</td>
                          <td>
                              <select id="payloadtypeCreateWrappedEncodingType">
                                <option name="base64">base64</option>
                              </select>
                          </td>
                      </tr>
                      <tr hidden id="payloadtypeCreateWrappedPayloadTypeRow">
                          <td style="width:150px">What kind of payload does this wrap?</td>
                          <td>
                              <select id="payloadtypeCreateWrappedPayloadType">

                              </select>
                          </td>
                      </tr>
                      <tr>
                          <td>Select code files to upload:</td>
                          <td><input multiple type="file" id="payloadtypeCreateUploadFiles"></td>
                      </tr>
            </table>
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn-primary" data-dismiss="modal" id="payloadtypeCreateSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR CREATING PAYLOADTYPE -->
<!-- THIS IS OUR MODAL FOR EDITING PAYLOADTYPE -->
<div class="modal fade bs-example-modal-md" id="payloadtypeEditModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3>Register a new PayloadType</h3>
            </div>
              <div class="modal-body">
                  <table cellpadding="10" style="width:100%">
                    <tr>
                        <td style="width:150px">Name</td>
                        <td><input type="text" id="payloadtypeEditPtype" size="50"></td>
                    </tr>
                      <tr>
                          <td style="width:150px">Payload file extension</td>
                          <td><input type="text" id="payloadtypeEditFileExtension" size="50"></td>
                      </tr>
                      <tr>
                          <td style="width:150px">Compile command</td>
                          <td><input type="text" id="payloadtypeEditCompileCommand" size="50"></td>
                      </tr>
                      <tr>
                          <td style="width:150px">Is this payload a wrapper for another payload?</td>
                          <td><input type="checkbox" id="payloadtypeEditWrapper"></td>
                      </tr>
                      <tr hidden id="payloadtypeEditWrappedEncodingTypeRow">
                          <td style="width:150px">Wrapped Payload Encoding Type</td>
                          <td>
                              <select id="payloadtypeEditWrappedEncodingType">
                                <option name="base64">base64</option>
                              </select>
                          </td>
                      </tr>
                      <tr hidden id="payloadtypeEditWrappedPayloadTypeRow">
                          <td style="width:150px">What kind of payload does this wrap?</td>
                          <td>
                              <select id="payloadtypeEditWrappedPayloadType">

                              </select>
                          </td>
                      </tr>
                      <tr>
                          <td>Select code files to upload:</td>
                          <td><input multiple type="file" id="payloadtypeEditUploadFiles"></td>
                      </tr>
            </table>
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn-primary" data-dismiss="modal" id="payloadtypeEditSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR EDITING PAYLOADTYPE -->
<!-- THIS IS OUR MODAL FOR DELETING PAYLOADTYPE -->
<div class="modal fade bs-example-modal-md" id="payloadtypeDeleteModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3>Delete a PayloadType</h3>
                Are you sure? This could have a lot of consequences for payload creation based on this and for tracking current/old callbacks based on this payloadtype.
            </div>
              <div class="modal-body" id="payloadtypeDeleteBody">
                Delete from disk? &nbsp;<input type="checkbox" id="payloadtypeDeleteFromDisk">
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn-primary" data-dismiss="modal" id="payloadtypeDeleteSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR DELETING PAYLOADTYPE -->
<!-- THIS IS OUR MODAL FOR IMPORTING COMMAND -->
<div class="modal fade bs-example-modal-md" id="commandImportModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3>Import a JSON file of commands</h3>
            </div>
              <div class="modal-body" id="commandImportBody">
                  <input type="file" id="commandImportFile">
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn-primary" data-dismiss="modal" id="commandImportSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR IMPORTING COMMAND -->
<!-- THIS IS OUR MODAL FOR REMOVING COMMANDS -->
<div class="modal fade bs-example-modal-md" id="commandRemoveModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3>Remove commands from payload type</h3>
            </div>
              <div class="modal-body" id="commandRemoveBody">
                <table>
                    <tr>
                        <td>
                            Select commands to remove:
                        </td>
                        <td>
                            <select multiple id="commandRemoveList" size="20">
                            </select>
                        </td>
                    </tr>
                </table>
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="commandRemoveSubmit">Remove</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR REMOVING COMMANDS -->
<!-- THIS IS OUR MODAL FOR ADDING COMMANDS -->
<div class="modal fade bs-example-modal-lg" id="commandAddModal" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3>Add a Command</h3>
            </div>
              <div class="modal-body" id="commandAddBody">
                <table>
                    <tr>
                        <td> Command Name: </td>
                        <td>
                            <input type="text" id="commandAddCmd" size="50">
                            <button class="btn btn-info" id="commandAddCheckCmd">Check Name</button>
                        </td>
                    </tr>
                    <tr>
                        <td> Description: </td>
                        <td><input type="text" id="commandAddDescription" size="90"></td>
                    </tr>
                    <tr>
                        <td> Help: </td>
                        <td><input type="text" id="commandAddHelpCmd" size="90"></td>
                    </tr>
                    <tr>
                        <td> Needs Admin: </td>
                        <td><input type="checkbox" id="commandAddNeedsAdmin"></td>
                    </tr>
                    <tr>
                        <td> Code: </td>
                        <td>
                            <textarea id="commandAddCode" rows="15" cols="80"></textarea>
                            <input type="file" id="commandAddFile">
                        </td>
                    </tr>
                </table>
                  <h3>Command Parameters:</h3>
                  <table id="add_command_parameters_table">
                      <tr v-for="(i,p) in add_command_parameters" :key="i.id">
                        <td>
                            <button type="button" class="btn btn-danger btn-sm" @click="remove_parameter_button(i,p)">X</button>
                        </td>
                        <td>
                            &nbsp;Name: <input type="text" size="10" :value="i.name" v-model="i.name">
                        </td>
                          <td>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Required? <input type="checkbox" :value="i.required" v-model="i.required">
                          </td>
                        <td>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String? <input type="checkbox" :value="i.isString" v-model="i.isString">
                        </td>
                          <td>
                              <div v-show="i.isString">
                                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Credential? <input type="checkbox" :value="i.isCredential" v-model="i.isCredential">
                              </div>
                          </td>
                        <td>
                            <div v-show="i.isString">
                                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hint: <input type="text" size="31" :value="i.hint" v-model="i.hint" v-show="i.isString">
                            </div>
                        </td>
                    </tr>
                      <tr>
                          <td>
                              <button type="button" class="btn btn-success btn-sm" @click="add_parameter_button()">Add</button>
                          </td>
                      </tr>

                  </table>
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true" id="commandAddCancel">Cancel</button>
                <button class="btn btn-primary" data-dismiss="modal" id="commandAddSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR ADDING COMMANDS -->
<!-- THIS IS OUR MODAL FOR EDITING COMMANDS -->
<div class="modal fade bs-example-modal-lg" id="commandEditModal" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h3>Edit a Command</h3>
            </div>
              <div class="modal-body" id="commanEditdBody">
                <table>
                    <tr>
                        <td> Command Name: </td>
                        <td><select id="commandEditCmd"></select></td>
                    </tr>
                    <tr>
                        <td> Description: </td>
                        <td><input type="text" id="commandEditDescription" size="90"></td>
                    </tr>
                    <tr>
                        <td> Help: </td>
                        <td><input type="text" id="commandEditHelpCmd" size="90"></td>
                    </tr>
                    <tr>
                        <td> Needs Admin: </td>
                        <td><input type="checkbox" id="commandEditNeedsAdmin"></td>
                    </tr>
                    <tr>
                        <td> Code: </td>
                        <td>
                            <textarea id="commandEditCode" rows="15" cols="80"></textarea>
                            <input type="file" id="commandEditFile">
                        </td>
                    </tr>
                </table>
                  <h3>Command Parameters:</h3>
                  <table id="edit_command_parameters_table">
                      <tr v-for="(i,p) in command_parameters" :key="i.id">
                        <td>
                            <button type="button" class="btn btn-danger btn-sm" @click="remove_parameter_button(i,p)">X</button>
                        </td>
                        <td>
                            &nbsp;Name: <input type="text" size="10" :value="i.name" v-model="i.name">
                        </td>
                          <td>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Required? <input type="checkbox" :value="i.required" v-model="i.required">
                          </td>
                        <td>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String? <input type="checkbox" :value="i.isString" v-model="i.isString">
                        </td>
                          <td>
                              <div v-show="i.isString">
                                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Credential? <input type="checkbox" :value="i.isCredential" v-model="i.isCredential">
                              </div>
                          </td>
                        <td>
                            <div v-show="i.isString">
                                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hint: <input type="text" size="31" :value="i.hint" v-model="i.hint" v-show="i.isString">
                            </div>
                        </td>
                    </tr>
                      <tr>
                          <td>
                              <button type="button" class="btn btn-success btn-sm" @click="add_parameter_button()">Add</button>
                          </td>
                      </tr>

                  </table>
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true" id="commandEditCancel">Cancel</button>
                <button class="btn btn-primary" data-dismiss="modal" id="commandEditSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR EDITING COMMANDS -->

<button type="button" class="btn btn-success btn-md" onclick="create_payloadtype_button()">New PayloadType</button>
{% endblock %}

{% block scripts %}
{% include "shared_javascript.js" %}
{% include "payload_management.js" %}
{% endblock %}
